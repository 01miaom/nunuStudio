function Nunu(){}Nunu.NAME='nunuStudio';Nunu.VERSION='V0.8.9.26 Alpha';Nunu.TIMESTAMP='201705241727';Nunu.webvrAvailable=function(){return void 0!==navigator.getVRDisplays};Nunu.webAudioAvailable=function(){return void 0!==window.AudioContext||void 0!==window.webkitAudioContext};Nunu.webglAvailable=function(){var a=['webgl','experimental-webgl','webgl2','experimental-webgl'];try{for(var b=document.createElement('canvas'),e=0;e<a.length;e++)if(void 0!==b.getContext(a[e]))return!0}catch(d){}return!1};
Nunu.runningOnDesktop=function(){return void 0!==window.nw};
(function(a,b){'object'===typeof exports&&'undefined'!==typeof module?b(exports):'function'===typeof define&&define.amd?define(['exports'],b):b(a.THREE=a.THREE||{})})(this,function(a){function b(){}function e(a,b){this.x=a||0;this.y=b||0}function d(a,b,f,g,k,h,q,l,n,p){Object.defineProperty(this,'id',{value:pb++});this.uuid=Oa.generateUUID();this.name='';this.image=void 0!==a?a:d.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:d.DEFAULT_MAPPING;this.wrapS=void 0!==f?f:1001;this.wrapT=void 0!==
g?g:1001;this.magFilter=void 0!==k?k:1006;this.minFilter=void 0!==h?h:1008;this.anisotropy=void 0!==n?n:1;this.format=void 0!==q?q:1023;this.type=void 0!==l?l:1009;this.offset=new e(0,0);this.repeat=new e(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==p?p:3E3;this.version=0;this.onUpdate=null}function f(a,b,d,e){this.x=a||0;this.y=b||0;this.z=d||0;this.w=void 0!==e?e:1}function g(a,b,e){this.uuid=Oa.generateUUID();this.width=a;this.height=
b;this.scissor=new f(0,0,a,b);this.scissorTest=!1;this.viewport=new f(0,0,a,b);e=e||{};void 0===e.minFilter&&(e.minFilter=1006);this.texture=new d(void 0,void 0,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding);this.depthBuffer=void 0!==e.depthBuffer?e.depthBuffer:!0;this.stencilBuffer=void 0!==e.stencilBuffer?e.stencilBuffer:!0;this.depthTexture=void 0!==e.depthTexture?e.depthTexture:null}function k(a,b,d){g.call(this,a,b,d);this.activeMipMapLevel=this.activeCubeFace=
0}function l(a,b,d,e){this._x=a||0;this._y=b||0;this._z=d||0;this._w=void 0!==e?e:1}function n(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0}function m(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];0<arguments.length&&console.error('THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.')}function p(a,b,e,f,g,k,h,q,l,n,p,m){d.call(this,null,k,h,q,l,n,f,g,p,m);this.image={data:a,width:b,height:e};this.magFilter=void 0!==l?l:1003;this.minFilter=void 0!==n?n:1003;this.flipY=this.generateMipmaps=
!1;this.unpackAlignment=1}function h(a,b,e,f,g,k,h,q,l,n){a=void 0!==a?a:[];d.call(this,a,void 0!==b?b:301,e,f,g,k,h,q,l,n);this.flipY=!1}function r(a,b,d){var t=a[0];if(0>=t||0<t)return a;var e=b*d,f=of[e];void 0===f&&(f=new Float32Array(e),of[e]=f);if(0!==b)for(t.toArray(f,0),t=1,e=0;t!==b;++t)e+=d,a[t].toArray(f,e);return f}function v(a,b){var t=Gf[b];void 0===t&&(t=new Int32Array(b),Gf[b]=t);for(var d=0;d!==b;++d)t[d]=a.allocTextureUnit();return t}function u(a,b){a.uniform1f(this.addr,b)}function x(a,
b){a.uniform1i(this.addr,b)}function y(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)}function q(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)}function w(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)}function B(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)}function A(a,b){void 0===b.elements?a.uniformMatrix3fv(this.addr,!1,b):(Hf.set(b.elements),a.uniformMatrix3fv(this.addr,
!1,Hf))}function C(a,b){void 0===b.elements?a.uniformMatrix4fv(this.addr,!1,b):(If.set(b.elements),a.uniformMatrix4fv(this.addr,!1,If))}function E(a,b,d){var t=d.allocTextureUnit();a.uniform1i(this.addr,t);d.setTexture2D(b||Ic,t)}function z(a,b,d){var t=d.allocTextureUnit();a.uniform1i(this.addr,t);d.setTextureCube(b||ae,t)}function D(a,b){a.uniform2iv(this.addr,b)}function K(a,b){a.uniform3iv(this.addr,b)}function G(a,b){a.uniform4iv(this.addr,b)}function M(a){switch(a){case 5126:return u;case 35664:return y;
case 35665:return q;case 35666:return w;case 35674:return B;case 35675:return A;case 35676:return C;case 35678:return E;case 35680:return z;case 5124:case 35670:return x;case 35667:case 35671:return D;case 35668:case 35672:return K;case 35669:case 35673:return G}}function J(a,b){a.uniform1fv(this.addr,b)}function L(a,b){a.uniform1iv(this.addr,b)}function I(a,b){a.uniform2fv(this.addr,r(b,this.size,2))}function F(a,b){a.uniform3fv(this.addr,r(b,this.size,3))}function U(a,b){a.uniform4fv(this.addr,
r(b,this.size,4))}function P(a,b){a.uniformMatrix2fv(this.addr,!1,r(b,this.size,4))}function Q(a,b){a.uniformMatrix3fv(this.addr,!1,r(b,this.size,9))}function N(a,b){a.uniformMatrix4fv(this.addr,!1,r(b,this.size,16))}function O(a,b,d){var t=b.length,e=v(d,t);a.uniform1iv(this.addr,e);for(a=0;a!==t;++a)d.setTexture2D(b[a]||Ic,e[a])}function R(a,b,d){var t=b.length,e=v(d,t);a.uniform1iv(this.addr,e);for(a=0;a!==t;++a)d.setTextureCube(b[a]||ae,e[a])}function T(a){switch(a){case 5126:return J;case 35664:return I;
case 35665:return F;case 35666:return U;case 35674:return P;case 35675:return Q;case 35676:return N;case 35678:return O;case 35680:return R;case 5124:case 35670:return L;case 35667:case 35671:return D;case 35668:case 35672:return K;case 35669:case 35673:return G}}function W(a,b,d){this.id=a;this.addr=d;this.setValue=M(b.type)}function V(a,b,d){this.id=a;this.addr=d;this.size=b.size;this.setValue=T(b.type)}function Y(a){this.id=a;this.seq=[];this.map={}}function aa(a,b,d){this.seq=[];this.map={};this.renderer=
d;d=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var t=0;t<d;++t){var e=a.getActiveUniform(b,t),f=a.getUniformLocation(b,e.name),H=this,g=e.name,k=g.length;for(wf.lastIndex=0;;){var h=wf.exec(g),q=wf.lastIndex,l=h[1],n=h[3];']'===h[2]&&(l|=0);if(void 0===n||'['===n&&q+2===k){g=H;e=void 0===n?new W(l,e,f):new V(l,e,f);g.seq.push(e);g.map[e.id]=e;break}else n=H.map[l],void 0===n&&(n=new Y(l),l=H,H=n,l.seq.push(H),l.map[H.id]=H),H=n}}}function ba(a,b,d){return void 0===b&&void 0===d?this.set(a):this.setRGB(a,
b,d)}function la(a,b){this.min=void 0!==a?a:new e(Infinity,Infinity);this.max=void 0!==b?b:new e(-Infinity,-Infinity)}function ha(a,b){var t,d,f,H,g,k,h,q,l,p,m=a.context,r=a.state,w,u,x,v,B;this.render=function(S,Sa,y){if(0!==b.length){S=new n;var Ea=y.w/y.z,A=.5*y.z,z=.5*y.w,Ba=16/y.w,D=new e(Ba*Ea,Ba),C=new n(1,1,0),pa=new e(1,1),ia=new la;ia.min.set(y.x,y.y);ia.max.set(y.x+(y.z-16),y.y+(y.w-16));if(void 0===x){var Ba=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),E=new Uint16Array([0,
1,2,0,2,3]);w=m.createBuffer();u=m.createBuffer();m.bindBuffer(m.ARRAY_BUFFER,w);m.bufferData(m.ARRAY_BUFFER,Ba,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,u);m.bufferData(m.ELEMENT_ARRAY_BUFFER,E,m.STATIC_DRAW);v=m.createTexture();B=m.createTexture();r.bindTexture(m.TEXTURE_2D,v);m.texImage2D(m.TEXTURE_2D,0,m.RGB,16,16,0,m.RGB,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,
m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);r.bindTexture(m.TEXTURE_2D,B);m.texImage2D(m.TEXTURE_2D,0,m.RGBA,16,16,0,m.RGBA,m.UNSIGNED_BYTE,null);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST);var Ba={vertexShader:'uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}',
fragmentShader:'uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}'},E=m.createProgram(),Wa=m.createShader(m.FRAGMENT_SHADER),
G=m.createShader(m.VERTEX_SHADER),Q='precision '+a.getPrecision()+' float;\n';m.shaderSource(Wa,Q+Ba.fragmentShader);m.shaderSource(G,Q+Ba.vertexShader);m.compileShader(Wa);m.compileShader(G);m.attachShader(E,Wa);m.attachShader(E,G);m.linkProgram(E);x=E;l=m.getAttribLocation(x,'position');p=m.getAttribLocation(x,'uv');t=m.getUniformLocation(x,'renderType');d=m.getUniformLocation(x,'map');f=m.getUniformLocation(x,'occlusionMap');H=m.getUniformLocation(x,'opacity');g=m.getUniformLocation(x,'color');
k=m.getUniformLocation(x,'scale');h=m.getUniformLocation(x,'rotation');q=m.getUniformLocation(x,'screenPosition')}m.useProgram(x);r.initAttributes();r.enableAttribute(l);r.enableAttribute(p);r.disableUnusedAttributes();m.uniform1i(f,0);m.uniform1i(d,1);m.bindBuffer(m.ARRAY_BUFFER,w);m.vertexAttribPointer(l,2,m.FLOAT,!1,16,0);m.vertexAttribPointer(p,2,m.FLOAT,!1,16,8);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,u);r.disable(m.CULL_FACE);r.buffers.depth.setMask(!1);E=0;for(Wa=b.length;E<Wa;E++)if(Ba=16/y.w,
D.set(Ba*Ea,Ba),G=b[E],S.set(G.matrixWorld.elements[12],G.matrixWorld.elements[13],G.matrixWorld.elements[14]),S.applyMatrix4(Sa.matrixWorldInverse),S.applyMatrix4(Sa.projectionMatrix),C.copy(S),pa.x=y.x+C.x*A+A-8,pa.y=y.y+C.y*z+z-8,!0===ia.containsPoint(pa)){r.activeTexture(m.TEXTURE0);r.bindTexture(m.TEXTURE_2D,null);r.activeTexture(m.TEXTURE1);r.bindTexture(m.TEXTURE_2D,v);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGB,pa.x,pa.y,16,16,0);m.uniform1i(t,0);m.uniform2f(k,D.x,D.y);m.uniform3f(q,C.x,C.y,C.z);
r.disable(m.BLEND);r.enable(m.DEPTH_TEST);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);r.activeTexture(m.TEXTURE0);r.bindTexture(m.TEXTURE_2D,B);m.copyTexImage2D(m.TEXTURE_2D,0,m.RGBA,pa.x,pa.y,16,16,0);m.uniform1i(t,1);r.disable(m.DEPTH_TEST);r.activeTexture(m.TEXTURE1);r.bindTexture(m.TEXTURE_2D,v);m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);G.positionScreen.copy(C);G.customUpdateCallback?G.customUpdateCallback(G):G.updateLensFlares();m.uniform1i(t,2);r.enable(m.BLEND);for(var Q=0,N=G.lensFlares.length;Q<
N;Q++){var F=G.lensFlares[Q];.001<F.opacity&&.001<F.scale&&(C.x=F.x,C.y=F.y,C.z=F.z,Ba=F.size*F.scale/y.w,D.x=Ba*Ea,D.y=Ba,m.uniform3f(q,C.x,C.y,C.z),m.uniform2f(k,D.x,D.y),m.uniform1f(h,F.rotation),m.uniform1f(H,F.opacity),m.uniform3f(g,F.color.r,F.color.g,F.color.b),r.setBlending(F.blending,F.blendEquation,F.blendSrc,F.blendDst),a.setTexture2D(F.texture,1),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0))}}r.enable(m.CULL_FACE);r.enable(m.DEPTH_TEST);r.buffers.depth.setMask(!0);a.resetGLState()}}}
function ca(a,b){function t(a,t){return a.renderOrder!==t.renderOrder?a.renderOrder-t.renderOrder:a.z!==t.z?t.z-a.z:t.id-a.id}var e,f,H,g,k,h,q,m,p,r,w,u,x,v,B,y,A,z=a.context,C=a.state,D,E,pa,G,Q=new n,F=new l,N=new n;this.render=function(l,n){if(0!==b.length){if(void 0===pa){var S=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),Sa=new Uint16Array([0,1,2,0,2,3]);D=z.createBuffer();E=z.createBuffer();z.bindBuffer(z.ARRAY_BUFFER,D);z.bufferData(z.ARRAY_BUFFER,S,z.STATIC_DRAW);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,
E);z.bufferData(z.ELEMENT_ARRAY_BUFFER,Sa,z.STATIC_DRAW);var S=z.createProgram(),Sa=z.createShader(z.VERTEX_SHADER),Ea=z.createShader(z.FRAGMENT_SHADER);z.shaderSource(Sa,['precision '+a.getPrecision()+' float;','uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}'].join('\n'));
z.shaderSource(Ea,['precision '+a.getPrecision()+' float;','uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}'].join('\n'));
z.compileShader(Sa);z.compileShader(Ea);z.attachShader(S,Sa);z.attachShader(S,Ea);z.linkProgram(S);pa=S;y=z.getAttribLocation(pa,'position');A=z.getAttribLocation(pa,'uv');e=z.getUniformLocation(pa,'uvOffset');f=z.getUniformLocation(pa,'uvScale');H=z.getUniformLocation(pa,'rotation');g=z.getUniformLocation(pa,'scale');k=z.getUniformLocation(pa,'color');h=z.getUniformLocation(pa,'map');q=z.getUniformLocation(pa,'opacity');m=z.getUniformLocation(pa,'modelViewMatrix');p=z.getUniformLocation(pa,'projectionMatrix');
r=z.getUniformLocation(pa,'fogType');w=z.getUniformLocation(pa,'fogDensity');u=z.getUniformLocation(pa,'fogNear');x=z.getUniformLocation(pa,'fogFar');v=z.getUniformLocation(pa,'fogColor');B=z.getUniformLocation(pa,'alphaTest');S=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');S.width=8;S.height=8;Sa=S.getContext('2d');Sa.fillStyle='white';Sa.fillRect(0,0,8,8);G=new d(S);G.needsUpdate=!0}z.useProgram(pa);C.initAttributes();C.enableAttribute(y);C.enableAttribute(A);C.disableUnusedAttributes();
C.disable(z.CULL_FACE);C.enable(z.BLEND);z.bindBuffer(z.ARRAY_BUFFER,D);z.vertexAttribPointer(y,2,z.FLOAT,!1,16,0);z.vertexAttribPointer(A,2,z.FLOAT,!1,16,8);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,E);z.uniformMatrix4fv(p,!1,n.projectionMatrix.elements);C.activeTexture(z.TEXTURE0);z.uniform1i(h,0);Sa=S=0;(Ea=l.fog)?(z.uniform3f(v,Ea.color.r,Ea.color.g,Ea.color.b),Ea.isFog?(z.uniform1f(u,Ea.near),z.uniform1f(x,Ea.far),z.uniform1i(r,1),Sa=S=1):Ea.isFogExp2&&(z.uniform1f(w,Ea.density),z.uniform1i(r,2),Sa=
S=2)):(z.uniform1i(r,0),Sa=S=0);for(var Ea=0,ia=b.length;Ea<ia;Ea++){var Ba=b[Ea];Ba.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,Ba.matrixWorld);Ba.z=-Ba.modelViewMatrix.elements[14]}b.sort(t);n=[];Ea=0;for(ia=b.length;Ea<ia;Ea++){var Ba=b[Ea],Wa=Ba.material;!1!==Wa.visible&&(z.uniform1f(B,Wa.alphaTest),z.uniformMatrix4fv(m,!1,Ba.modelViewMatrix.elements),Ba.matrixWorld.decompose(Q,F,N),n[0]=N.x,n[1]=N.y,Ba=0,l.fog&&Wa.fog&&(Ba=Sa),S!==Ba&&(z.uniform1i(r,Ba),S=Ba),null!==Wa.map?(z.uniform2f(e,
Wa.map.offset.x,Wa.map.offset.y),z.uniform2f(f,Wa.map.repeat.x,Wa.map.repeat.y)):(z.uniform2f(e,0,0),z.uniform2f(f,1,1)),z.uniform1f(q,Wa.opacity),z.uniform3f(k,Wa.color.r,Wa.color.g,Wa.color.b),z.uniform1f(H,Wa.rotation),z.uniform2fv(g,n),C.setBlending(Wa.blending,Wa.blendEquation,Wa.blendSrc,Wa.blendDst,Wa.blendEquationAlpha,Wa.blendSrcAlpha,Wa.blendDstAlpha,Wa.premultipliedAlpha),C.buffers.depth.setTest(Wa.depthTest),C.buffers.depth.setMask(Wa.depthWrite),Wa.map?a.setTexture2D(Wa.map,0):a.setTexture2D(G,
0),z.drawElements(z.TRIANGLES,6,z.UNSIGNED_SHORT,0))}C.enable(z.CULL_FACE);a.resetGLState()}}}function Z(){Object.defineProperty(this,'id',{value:Pe++});this.uuid=Oa.generateUUID();this.name='';this.type='Material';this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=
!0;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.dithering=!1;this.alphaTest=0;this.premultipliedAlpha=!1;this.overdraw=0;this.needsUpdate=this.visible=!0}function oa(a){Z.call(this);this.type='ShaderMaterial';this.defines={};this.uniforms={};this.vertexShader='void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}';this.fragmentShader=
'void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}';this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error('THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.'),
this.setValues(a))}function ja(a){Z.call(this);this.type='MeshDepthMaterial';this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function fa(a,b){this.min=void 0!==a?a:new n(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new n(-Infinity,-Infinity,-Infinity)}function za(a,b){this.center=void 0!==a?a:new n;this.radius=
void 0!==b?b:0}function Ga(){this.elements=[1,0,0,0,1,0,0,0,1];0<arguments.length&&console.error('THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.')}function ua(a,b){this.normal=void 0!==a?a:new n(1,0,0);this.constant=void 0!==b?b:0}function ta(a,b,d,e,f,g){this.planes=[void 0!==a?a:new ua,void 0!==b?b:new ua,void 0!==d?d:new ua,void 0!==e?e:new ua,void 0!==f?f:new ua,void 0!==g?g:new ua]}function Pa(a,b,d,k){function t(t,b,d,e){var f=t.geometry,H;H=x;var g=t.customDepthMaterial;
d&&(H=v,g=t.customDistanceMaterial);g?H=g:(g=!1,b.morphTargets&&(f&&f.isBufferGeometry?g=f.morphAttributes&&f.morphAttributes.position&&0<f.morphAttributes.position.length:f&&f.isGeometry&&(g=f.morphTargets&&0<f.morphTargets.length)),t.isSkinnedMesh&&!1===b.skinning&&console.warn('THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:',t),t=t.isSkinnedMesh&&b.skinning,f=0,g&&(f|=1),t&&(f|=2),H=H[f]);a.localClippingEnabled&&!0===b.clipShadows&&0!==b.clippingPlanes.length&&(f=
H.uuid,g=b.uuid,t=B[f],void 0===t&&(t={},B[f]=t),f=t[g],void 0===f&&(f=H.clone(),t[g]=f),H=f);H.visible=b.visible;H.wireframe=b.wireframe;g=b.side;Q.renderSingleSided&&2==g&&(g=0);Q.renderReverseSided&&(0===g?g=1:1===g&&(g=0));H.side=g;H.clipShadows=b.clipShadows;H.clippingPlanes=b.clippingPlanes;H.wireframeLinewidth=b.wireframeLinewidth;H.linewidth=b.linewidth;d&&void 0!==H.uniforms.lightPos&&H.uniforms.lightPos.value.copy(e);return H}function H(b,e,f,g){if(!1!==b.visible){if(b.layers.test(e.layers)&&
(b.isMesh||b.isLine||b.isPoints)&&b.castShadow&&(!b.frustumCulled||l.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(f.matrixWorldInverse,b.matrixWorld);var k=d.update(b),h=b.material;if(Array.isArray(h))for(var q=k.groups,n=0,m=q.length;n<m;n++){var p=q[n],S=h[p.materialIndex];S&&S.visible&&(S=t(b,S,g,u),a.renderBufferDirect(f,null,k,S,b,p))}else h.visible&&(S=t(b,h,g,u),a.renderBufferDirect(f,null,k,S,b,null))}b=b.children;k=0;for(h=b.length;k<h;k++)H(b[k],e,f,g)}}var h=a.context,q=a.state,
l=new ta,p=new m,S=b.shadows,r=new e,w=new e(k.maxTextureSize,k.maxTextureSize),Sa=new n,u=new n,x=Array(4),v=Array(4),B={},y=[new n(1,0,0),new n(-1,0,0),new n(0,0,1),new n(0,0,-1),new n(0,1,0),new n(0,-1,0)],A=[new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,0,1),new n(0,0,-1)],z=[new f,new f,new f,new f,new f,new f];b=new ja;b.depthPacking=3201;b.clipping=!0;k=be.distanceRGBA;for(var C=oc.clone(k.uniforms),D=0;4!==D;++D){var pa=0!==(D&1),E=0!==(D&2),G=b.clone();G.morphTargets=pa;G.skinning=
E;x[D]=G;pa=new oa({defines:{USE_SHADOWMAP:''},uniforms:C,vertexShader:k.vertexShader,fragmentShader:k.fragmentShader,morphTargets:pa,skinning:E,clipping:!0});v[D]=pa}var Q=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(t,b){if(!1!==Q.enabled&&(!1!==Q.autoUpdate||!1!==Q.needsUpdate)&&0!==S.length){q.disable(h.BLEND);q.buffers.color.setClear(1,1,1,1);q.buffers.depth.setTest(!0);q.setScissorTest(!1);for(var d,
e=0,f=S.length;e<f;e++){var k=S[e];d=k.shadow;var n=k&&k.isPointLight;if(void 0===d)console.warn('THREE.WebGLShadowMap:',k,'has no shadow.');else{var m=d.camera;r.copy(d.mapSize);r.min(w);if(n){var x=r.x,v=r.y;z[0].set(2*x,v,x,v);z[1].set(0,v,x,v);z[2].set(3*x,v,x,v);z[3].set(x,v,x,v);z[4].set(3*x,0,x,v);z[5].set(x,0,x,v);r.x*=4;r.y*=2}null===d.map&&(d.map=new g(r.x,r.y,{minFilter:1003,magFilter:1003,format:1023}),d.map.texture.name=k.name+'.shadowMap',m.updateProjectionMatrix());d.isSpotLightShadow&&
d.update(k);x=d.map;v=d.matrix;u.setFromMatrixPosition(k.matrixWorld);m.position.copy(u);n?(d=6,v.makeTranslation(-u.x,-u.y,-u.z)):(d=1,Sa.setFromMatrixPosition(k.target.matrixWorld),m.lookAt(Sa),m.updateMatrixWorld(),m.matrixWorldInverse.getInverse(m.matrixWorld),v.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),v.multiply(m.projectionMatrix),v.multiply(m.matrixWorldInverse));a.setRenderTarget(x);a.clear();for(k=0;k<d;k++)n&&(Sa.copy(m.position),Sa.add(y[k]),m.up.copy(A[k]),m.lookAt(Sa),m.updateMatrixWorld(),
m.matrixWorldInverse.getInverse(m.matrixWorld),q.viewport(z[k])),p.multiplyMatrices(m.projectionMatrix,m.matrixWorldInverse),l.setFromMatrix(p),H(t,b,m,n)}}e=a.getClearColor();f=a.getClearAlpha();a.setClearColor(e,f);Q.needsUpdate=!1}}}function na(a,b){this.origin=void 0!==a?a:new n;this.direction=void 0!==b?b:new n}function Ca(a,b,d,e){this._x=a||0;this._y=b||0;this._z=d||0;this._order=e||Ca.DefaultOrder}function Aa(){this.mask=1}function ka(){Object.defineProperty(this,'id',{value:gg++});this.uuid=
Oa.generateUUID();this.name='';this.type='Object3D';this.parent=null;this.children=[];this.up=ka.DefaultUp.clone();var a=new n,b=new Ca,d=new l,e=new n(1,1,1);b.onChange(function(){d.setFromEuler(b,!1)});d.onChange(function(){b.setFromQuaternion(d,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:d},scale:{enumerable:!0,value:e},modelViewMatrix:{value:new m},normalMatrix:{value:new Ga}});this.matrix=new m;this.matrixWorld=
new m;this.matrixAutoUpdate=ka.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Aa;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}}function wa(a,b){this.start=void 0!==a?a:new n;this.end=void 0!==b?b:new n}function va(a,b,d){this.a=void 0!==a?a:new n;this.b=void 0!==b?b:new n;this.c=void 0!==d?d:new n}function Ua(a,b,d,e,f,g){this.a=a;this.b=b;this.c=d;this.normal=e&&e.isVector3?e:new n;this.vertexNormals=Array.isArray(e)?
e:[];this.color=f&&f.isColor?f:new ba;this.vertexColors=Array.isArray(f)?f:[];this.materialIndex=void 0!==g?g:0}function Ja(a){Z.call(this);this.type='MeshBasicMaterial';this.color=new ba(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap='round';this.lights=
this.morphTargets=this.skinning=!1;this.setValues(a)}function sa(a,b,d){if(Array.isArray(a))throw new TypeError('THREE.BufferAttribute: array should be a Typed Array.');this.uuid=Oa.generateUUID();this.name='';this.array=a;this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=!0===d;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function ab(a,b){sa.call(this,new Int8Array(a),b)}function cb(a,b){sa.call(this,new Uint8Array(a),b)}
function xa(a,b){sa.call(this,new Uint8ClampedArray(a),b)}function Ya(a,b){sa.call(this,new Int16Array(a),b)}function Da(a,b){sa.call(this,new Uint16Array(a),b)}function Ma(a,b){sa.call(this,new Int32Array(a),b)}function Lb(a,b){sa.call(this,new Uint32Array(a),b)}function ea(a,b){sa.call(this,new Float32Array(a),b)}function wb(a,b){sa.call(this,new Float64Array(a),b)}function hb(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets=
{};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function jb(a){if(0===a.length)return-Infinity;for(var t=a[0],b=1,d=a.length;b<d;++b)a[b]>t&&(t=a[b]);return t}function ra(){Object.defineProperty(this,'id',{value:ce++});this.uuid=Oa.generateUUID();this.name='';this.type='Geometry';this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];
this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function ga(){Object.defineProperty(this,'id',{value:ce++});this.uuid=Oa.generateUUID();this.name='';this.type='BufferGeometry';this.index=null;this.attributes={};this.morphAttributes={};this.groups=
[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function Za(a,b){ka.call(this);this.type='Mesh';this.geometry=void 0!==a?a:new ga;this.material=void 0!==b?b:new Ja({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function eb(a,b,d,e,f,g){ra.call(this);this.type='BoxGeometry';this.parameters={width:a,height:b,depth:d,widthSegments:e,heightSegments:f,depthSegments:g};this.fromBufferGeometry(new Va(a,b,d,e,f,g));this.mergeVertices()}function Va(a,
b,d,e,f,g){function t(a,t,b,d,e,f,g,S,r,w,Sa){var u=f/r,x=g/w,v=f/2,B=g/2,y=S/2;g=r+1;var Ea=w+1,A=f=0,z,Ba,C=new n;for(Ba=0;Ba<Ea;Ba++){var D=Ba*x-B;for(z=0;z<g;z++)C[a]=(z*u-v)*d,C[t]=D*e,C[b]=y,h.push(C.x,C.y,C.z),C[a]=0,C[t]=0,C[b]=0<S?1:-1,q.push(C.x,C.y,C.z),l.push(z/r),l.push(1-Ba/w),f+=1}for(Ba=0;Ba<w;Ba++)for(z=0;z<r;z++)a=m+z+g*(Ba+1),t=m+(z+1)+g*(Ba+1),b=m+(z+1)+g*Ba,k.push(m+z+g*Ba,a,b),k.push(a,t,b),A+=6;H.addGroup(p,A,Sa);p+=A;m+=f}ga.call(this);this.type='BoxBufferGeometry';this.parameters=
{width:a,height:b,depth:d,widthSegments:e,heightSegments:f,depthSegments:g};var H=this;e=Math.floor(e)||1;f=Math.floor(f)||1;g=Math.floor(g)||1;var k=[],h=[],q=[],l=[],m=0,p=0;t('z','y','x',-1,-1,d,b,a,g,f,0);t('z','y','x',1,-1,d,b,-a,g,f,1);t('x','z','y',1,1,a,d,b,e,g,2);t('x','z','y',1,-1,a,d,-b,e,g,3);t('x','y','z',1,-1,a,b,d,e,f,4);t('x','y','z',-1,-1,a,b,-d,e,f,5);this.setIndex(k);this.addAttribute('position',new ea(h,3));this.addAttribute('normal',new ea(q,3));this.addAttribute('uv',new ea(l,
2))}function bb(a,b,d,e){ra.call(this);this.type='PlaneGeometry';this.parameters={width:a,height:b,widthSegments:d,heightSegments:e};this.fromBufferGeometry(new ub(a,b,d,e));this.mergeVertices()}function ub(a,b,d,e){ga.call(this);this.type='PlaneBufferGeometry';this.parameters={width:a,height:b,widthSegments:d,heightSegments:e};var t=a/2,f=b/2;d=Math.floor(d)||1;e=Math.floor(e)||1;var H=d+1,g=e+1,k=a/d,h=b/e,q=[],l=[],n=[],m=[];for(a=0;a<g;a++){var p=a*h-f;for(b=0;b<H;b++)l.push(b*k-t,-p,0),n.push(0,
0,1),m.push(b/d),m.push(1-a/e)}for(a=0;a<e;a++)for(b=0;b<d;b++)t=b+H*(a+1),f=b+1+H*(a+1),g=b+1+H*a,q.push(b+H*a,t,g),q.push(t,f,g);this.setIndex(q);this.addAttribute('position',new ea(l,3));this.addAttribute('normal',new ea(n,3));this.addAttribute('uv',new ea(m,2))}function kb(){ka.call(this);this.type='Camera';this.matrixWorldInverse=new m;this.projectionMatrix=new m}function Ha(a,b,d,e){kb.call(this);this.type='PerspectiveCamera';this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==d?d:.1;this.far=
void 0!==e?e:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function fc(a,b,d,e,f,g){kb.call(this);this.type='OrthographicCamera';this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=d;this.bottom=e;this.near=void 0!==f?f:.1;this.far=void 0!==g?g:2E3;this.updateProjectionMatrix()}function Ub(a){var t={};return{get:function(a){a.isInterleavedBufferAttribute&&(a=a.data);return t[a.uuid]},remove:function(b){var d=
t[b.uuid];d&&(a.deleteBuffer(d.buffer),delete t[b.uuid])},update:function(b,d){b.isInterleavedBufferAttribute&&(b=b.data);var e=t[b.uuid];if(void 0===e){var e=b.uuid,f=b,H=f.array;b=f.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW;var g=a.createBuffer();a.bindBuffer(d,g);a.bufferData(d,H,b);f.onUploadCallback();b=a.FLOAT;H instanceof Float32Array?b=a.FLOAT:H instanceof Float64Array?console.warn('THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.'):H instanceof Uint16Array?b=a.UNSIGNED_SHORT:
H instanceof Int16Array?b=a.SHORT:H instanceof Uint32Array?b=a.UNSIGNED_INT:H instanceof Int32Array?b=a.INT:H instanceof Int8Array?b=a.BYTE:H instanceof Uint8Array&&(b=a.UNSIGNED_BYTE);t[e]={buffer:g,type:b,bytesPerElement:H.BYTES_PER_ELEMENT,version:f.version}}else e.version<b.version&&(f=b,H=f.array,g=f.updateRange,a.bindBuffer(d,e.buffer),!1===f.dynamic?a.bufferData(d,H,a.STATIC_DRAW):-1===g.count?a.bufferSubData(d,0,H):0===g.count?console.error('THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.'):
(a.bufferSubData(d,g.offset*H.BYTES_PER_ELEMENT,H.subarray(g.offset,g.offset+g.count)),g.count=0),e.version=b.version)}}}function qa(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program&&b.program&&a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function Qa(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function ma(){var a=[],b=-1,d=[],
e=-1;return{opaque:a,transparent:d,init:function(){e=b=-1},push:function(t,f,H,g,k){var h,q;H.transparent?(h=d,q=++e):(h=a,q=++b);(q=h[q])?(q.id=t.id,q.object=t,q.geometry=f,q.material=H,q.program=H.program,q.renderOrder=t.renderOrder,q.z=g,q.group=k):(q={id:t.id,object:t,geometry:f,material:H,program:H.program,renderOrder:t.renderOrder,z:g,group:k},h.push(q))},finish:function(){a.length=b+1;d.length=e+1},sort:function(){a.sort(qa);d.sort(Qa)}}}function Ra(){var a={};return{get:function(t,b){t=t.id+
','+b.id;b=a[t];void 0===b&&(b=new ma,a[t]=b);return b},dispose:function(){a={}}}}function gc(a,b,d){var t,e,f;this.setMode=function(a){t=a};this.setIndex=function(t){t.array instanceof Uint32Array&&b.get('OES_element_index_uint')?(e=a.UNSIGNED_INT,f=4):t.array instanceof Uint16Array?(e=a.UNSIGNED_SHORT,f=2):(e=a.UNSIGNED_BYTE,f=1)};this.render=function(b,H){a.drawElements(t,H,e,b*f);d.calls++;d.vertices+=H;t===a.TRIANGLES&&(d.faces+=H/3)};this.renderInstances=function(H,g,k){var h=b.get('ANGLE_instanced_arrays');
null===h?console.error('THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.'):(h.drawElementsInstancedANGLE(t,k,e,g*f,H.maxInstancedCount),d.calls++,d.vertices+=k*H.maxInstancedCount,t===a.TRIANGLES&&(d.faces+=H.maxInstancedCount*k/3))}}function kc(a,b,d){var t;this.setMode=function(a){t=a};this.render=function(b,e){a.drawArrays(t,b,e);d.calls++;d.vertices+=e;t===a.TRIANGLES&&(d.faces+=e/3)};this.renderInstances=function(e,
f,H){var g=b.get('ANGLE_instanced_arrays');if(null===g)console.error('THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.');else{var k=e.attributes.position;k.isInterleavedBufferAttribute?(H=k.data.count,g.drawArraysInstancedANGLE(t,0,H,e.maxInstancedCount)):g.drawArraysInstancedANGLE(t,f,H,e.maxInstancedCount);d.calls++;d.vertices+=H*e.maxInstancedCount;t===a.TRIANGLES&&(d.faces+=e.maxInstancedCount*H/3)}}}function de(a,b,
d){function t(a){a=a.target;var H=e[a.id];null!==H.index&&b.remove(H.index);for(var g in H.attributes)b.remove(H.attributes[g]);a.removeEventListener('dispose',t);delete e[a.id];if(g=f[a.id])b.remove(g),delete f[a.id];if(g=f[H.id])b.remove(g),delete f[H.id];d.geometries--}var e={},f={};return{get:function(a,b){var f=e[b.id];if(f)return f;b.addEventListener('dispose',t);b.isBufferGeometry?f=b:b.isGeometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new ga).setFromObject(a)),f=b._bufferGeometry);
e[b.id]=f;d.geometries++;return f},update:function(t){var d=t.index,e=t.attributes;null!==d&&b.update(d,a.ELEMENT_ARRAY_BUFFER);for(var f in e)b.update(e[f],a.ARRAY_BUFFER);t=t.morphAttributes;for(f in t)for(var d=t[f],e=0,H=d.length;e<H;e++)b.update(d[e],a.ARRAY_BUFFER)},getWireframeAttribute:function(t){var d=f[t.id];if(d)return d;var d=[],e=t.index,H=t.attributes;if(null!==e)for(var e=e.array,H=0,g=e.length;H<g;H+=3){var k=e[H+0],h=e[H+1],q=e[H+2];d.push(k,h,h,q,q,k)}else for(e=H.position.array,
H=0,g=e.length/3-1;H<g;H+=3)k=H+0,h=H+1,q=H+2,d.push(k,h,h,q,q,k);d=new (65535<jb(d)?Lb:Da)(d,1);b.update(d,a.ELEMENT_ARRAY_BUFFER);return f[t.id]=d}}}function hd(){var a={};return{get:function(t){if(void 0!==a[t.id])return a[t.id];var b;switch(t.type){case 'DirectionalLight':b={direction:new n,color:new ba,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new e};break;case 'SpotLight':b={position:new n,direction:new n,color:new ba,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,
shadowRadius:1,shadowMapSize:new e};break;case 'PointLight':b={position:new n,color:new ba,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new e};break;case 'HemisphereLight':b={direction:new n,skyColor:new ba,groundColor:new ba};break;case 'RectAreaLight':b={color:new ba,position:new n,halfWidth:new n,halfHeight:new n}}return a[t.id]=b}}}function hc(a,b,d){var t={};return{update:function(a){var e=d.frame,f=a.geometry,H=b.get(a,f);t[H.id]!==e&&(f.isGeometry&&H.updateFromObject(a),
b.update(H),t[H.id]=e);return H},clear:function(){t={}}}}function ac(a){a=a.split('\n');for(var t=0;t<a.length;t++)a[t]=t+1+': '+a[t];return a.join('\n')}function Qb(a,b,d){var t=a.createShader(b);a.shaderSource(t,d);a.compileShader(t);!1===a.getShaderParameter(t,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");''!==a.getShaderInfoLog(t)&&console.warn('THREE.WebGLShader: gl.getShaderInfoLog()',b===a.VERTEX_SHADER?'vertex':'fragment',a.getShaderInfoLog(t),ac(d));return t}
function Jc(a){switch(a){case 3E3:return['Linear','( value )'];case 3001:return['sRGB','( value )'];case 3002:return['RGBE','( value )'];case 3004:return['RGBM','( value, 7.0 )'];case 3005:return['RGBM','( value, 16.0 )'];case 3006:return['RGBD','( value, 256.0 )'];case 3007:return['Gamma','( value, float( GAMMA_FACTOR ) )'];default:throw Error('unsupported encoding: '+a);}}function Ac(a,b){b=Jc(b);return'vec4 '+a+'( vec4 value ) { return '+b[0]+'ToLinear'+b[1]+'; }'}function fb(a,b){b=Jc(b);return'vec4 '+
a+'( vec4 value ) { return LinearTo'+b[0]+b[1]+'; }'}function Mb(a,b){switch(b){case 1:b='Linear';break;case 2:b='Reinhard';break;case 3:b='Uncharted2';break;case 4:b='OptimizedCineon';break;default:throw Error('unsupported toneMapping: '+b);}return'vec3 '+a+'( vec3 color ) { return '+b+'ToneMapping( color ); }'}function pa(a,b,d){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?'#extension GL_OES_standard_derivatives : enable':'',(a.fragDepth||b.logarithmicDepthBuffer)&&
d.get('EXT_frag_depth')?'#extension GL_EXT_frag_depth : enable':'',a.drawBuffers&&d.get('WEBGL_draw_buffers')?'#extension GL_EXT_draw_buffers : require':'',(a.shaderTextureLOD||b.envMap)&&d.get('EXT_shader_texture_lod')?'#extension GL_EXT_shader_texture_lod : enable':''].filter(Gb).join('\n')}function Ka(a){var t=[],b;for(b in a){var d=a[b];!1!==d&&t.push('#define '+b+' '+d)}return t.join('\n')}function Gb(a){return''!==a}function La(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,
b.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function db(a){return a.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,function(a,t){a=lb[t];if(void 0===a)throw Error('Can not resolve #include <'+t+'>');return db(a)})}function Kc(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,t,b,d){a='';for(t=parseInt(t);t<parseInt(b);t++)a+=d.replace(/\[ i \]/g,
'[ '+t+' ]');return a})}function X(a,b,d,e){var t=a.context,f=d.extensions,g=d.defines,H=d.__webglShader.vertexShader,k=d.__webglShader.fragmentShader,h='SHADOWMAP_TYPE_BASIC';1===e.shadowMapType?h='SHADOWMAP_TYPE_PCF':2===e.shadowMapType&&(h='SHADOWMAP_TYPE_PCF_SOFT');var q='ENVMAP_TYPE_CUBE',l='ENVMAP_MODE_REFLECTION',n='ENVMAP_BLENDING_MULTIPLY';if(e.envMap){switch(d.envMap.mapping){case 301:case 302:q='ENVMAP_TYPE_CUBE';break;case 306:case 307:q='ENVMAP_TYPE_CUBE_UV';break;case 303:case 304:q=
'ENVMAP_TYPE_EQUIREC';break;case 305:q='ENVMAP_TYPE_SPHERE'}switch(d.envMap.mapping){case 302:case 304:l='ENVMAP_MODE_REFRACTION'}switch(d.combine){case 0:n='ENVMAP_BLENDING_MULTIPLY';break;case 1:n='ENVMAP_BLENDING_MIX';break;case 2:n='ENVMAP_BLENDING_ADD'}}var m=0<a.gammaFactor?a.gammaFactor:1,f=pa(f,e,a.extensions),p=Ka(g),r=t.createProgram();d.isRawShaderMaterial?(g=[p,'\n'].filter(Gb).join('\n'),h=[f,p,'\n'].filter(Gb).join('\n')):(g=['precision '+e.precision+' float;','precision '+e.precision+
' int;','#define SHADER_NAME '+d.__webglShader.name,p,e.supportsVertexTextures?'#define VERTEX_TEXTURES':'','#define GAMMA_FACTOR '+m,'#define MAX_BONES '+e.maxBones,e.useFog&&e.fog?'#define USE_FOG':'',e.useFog&&e.fogExp?'#define FOG_EXP2':'',e.map?'#define USE_MAP':'',e.envMap?'#define USE_ENVMAP':'',e.envMap?'#define '+l:'',e.lightMap?'#define USE_LIGHTMAP':'',e.aoMap?'#define USE_AOMAP':'',e.emissiveMap?'#define USE_EMISSIVEMAP':'',e.bumpMap?'#define USE_BUMPMAP':'',e.normalMap?'#define USE_NORMALMAP':
'',e.displacementMap&&e.supportsVertexTextures?'#define USE_DISPLACEMENTMAP':'',e.specularMap?'#define USE_SPECULARMAP':'',e.roughnessMap?'#define USE_ROUGHNESSMAP':'',e.metalnessMap?'#define USE_METALNESSMAP':'',e.alphaMap?'#define USE_ALPHAMAP':'',e.vertexColors?'#define USE_COLOR':'',e.flatShading?'#define FLAT_SHADED':'',e.skinning?'#define USE_SKINNING':'',e.useVertexTexture?'#define BONE_TEXTURE':'',e.morphTargets?'#define USE_MORPHTARGETS':'',e.morphNormals&&!1===e.flatShading?'#define USE_MORPHNORMALS':
'',e.doubleSided?'#define DOUBLE_SIDED':'',e.flipSided?'#define FLIP_SIDED':'','#define NUM_CLIPPING_PLANES '+e.numClippingPlanes,e.shadowMapEnabled?'#define USE_SHADOWMAP':'',e.shadowMapEnabled?'#define '+h:'',e.sizeAttenuation?'#define USE_SIZEATTENUATION':'',e.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',e.logarithmicDepthBuffer&&a.extensions.get('EXT_frag_depth')?'#define USE_LOGDEPTHBUF_EXT':'','uniform mat4 modelMatrix;','uniform mat4 modelViewMatrix;','uniform mat4 projectionMatrix;',
'uniform mat4 viewMatrix;','uniform mat3 normalMatrix;','uniform vec3 cameraPosition;','attribute vec3 position;','attribute vec3 normal;','attribute vec2 uv;','#ifdef USE_COLOR','\tattribute vec3 color;','#endif','#ifdef USE_MORPHTARGETS','\tattribute vec3 morphTarget0;','\tattribute vec3 morphTarget1;','\tattribute vec3 morphTarget2;','\tattribute vec3 morphTarget3;','\t#ifdef USE_MORPHNORMALS','\t\tattribute vec3 morphNormal0;','\t\tattribute vec3 morphNormal1;','\t\tattribute vec3 morphNormal2;',
'\t\tattribute vec3 morphNormal3;','\t#else','\t\tattribute vec3 morphTarget4;','\t\tattribute vec3 morphTarget5;','\t\tattribute vec3 morphTarget6;','\t\tattribute vec3 morphTarget7;','\t#endif','#endif','#ifdef USE_SKINNING','\tattribute vec4 skinIndex;','\tattribute vec4 skinWeight;','#endif','\n'].filter(Gb).join('\n'),h=[f,'precision '+e.precision+' float;','precision '+e.precision+' int;','#define SHADER_NAME '+d.__webglShader.name,p,e.alphaTest?'#define ALPHATEST '+e.alphaTest:'','#define GAMMA_FACTOR '+
m,e.useFog&&e.fog?'#define USE_FOG':'',e.useFog&&e.fogExp?'#define FOG_EXP2':'',e.map?'#define USE_MAP':'',e.envMap?'#define USE_ENVMAP':'',e.envMap?'#define '+q:'',e.envMap?'#define '+l:'',e.envMap?'#define '+n:'',e.lightMap?'#define USE_LIGHTMAP':'',e.aoMap?'#define USE_AOMAP':'',e.emissiveMap?'#define USE_EMISSIVEMAP':'',e.bumpMap?'#define USE_BUMPMAP':'',e.normalMap?'#define USE_NORMALMAP':'',e.specularMap?'#define USE_SPECULARMAP':'',e.roughnessMap?'#define USE_ROUGHNESSMAP':'',e.metalnessMap?
'#define USE_METALNESSMAP':'',e.alphaMap?'#define USE_ALPHAMAP':'',e.vertexColors?'#define USE_COLOR':'',e.gradientMap?'#define USE_GRADIENTMAP':'',e.flatShading?'#define FLAT_SHADED':'',e.doubleSided?'#define DOUBLE_SIDED':'',e.flipSided?'#define FLIP_SIDED':'','#define NUM_CLIPPING_PLANES '+e.numClippingPlanes,'#define UNION_CLIPPING_PLANES '+(e.numClippingPlanes-e.numClipIntersection),e.shadowMapEnabled?'#define USE_SHADOWMAP':'',e.shadowMapEnabled?'#define '+h:'',e.premultipliedAlpha?'#define PREMULTIPLIED_ALPHA':
'',e.physicallyCorrectLights?'#define PHYSICALLY_CORRECT_LIGHTS':'',e.logarithmicDepthBuffer?'#define USE_LOGDEPTHBUF':'',e.logarithmicDepthBuffer&&a.extensions.get('EXT_frag_depth')?'#define USE_LOGDEPTHBUF_EXT':'',e.envMap&&a.extensions.get('EXT_shader_texture_lod')?'#define TEXTURE_LOD_EXT':'','uniform mat4 viewMatrix;','uniform vec3 cameraPosition;',0!==e.toneMapping?'#define TONE_MAPPING':'',0!==e.toneMapping?lb.tonemapping_pars_fragment:'',0!==e.toneMapping?Mb('toneMapping',e.toneMapping):'',
e.dithering?'#define DITHERING':'',e.outputEncoding||e.mapEncoding||e.envMapEncoding||e.emissiveMapEncoding?lb.encodings_pars_fragment:'',e.mapEncoding?Ac('mapTexelToLinear',e.mapEncoding):'',e.envMapEncoding?Ac('envMapTexelToLinear',e.envMapEncoding):'',e.emissiveMapEncoding?Ac('emissiveMapTexelToLinear',e.emissiveMapEncoding):'',e.outputEncoding?fb('linearToOutputTexel',e.outputEncoding):'',e.depthPacking?'#define DEPTH_PACKING '+d.depthPacking:'','\n'].filter(Gb).join('\n'));H=db(H);H=La(H,e);
k=db(k);k=La(k,e);d.isShaderMaterial||(H=Kc(H),k=Kc(k));k=h+k;H=Qb(t,t.VERTEX_SHADER,g+H);k=Qb(t,t.FRAGMENT_SHADER,k);t.attachShader(r,H);t.attachShader(r,k);void 0!==d.index0AttributeName?t.bindAttribLocation(r,0,d.index0AttributeName):!0===e.morphTargets&&t.bindAttribLocation(r,0,'position');t.linkProgram(r);e=t.getProgramInfoLog(r);q=t.getShaderInfoLog(H);l=t.getShaderInfoLog(k);m=n=!0;if(!1===t.getProgramParameter(r,t.LINK_STATUS))n=!1,console.error('THREE.WebGLProgram: shader error: ',t.getError(),
'gl.VALIDATE_STATUS',t.getProgramParameter(r,t.VALIDATE_STATUS),'gl.getProgramInfoLog',e,q,l);else if(''!==e)console.warn('THREE.WebGLProgram: gl.getProgramInfoLog()',e);else if(''===q||''===l)m=!1;m&&(this.diagnostics={runnable:n,material:d,programLog:e,vertexShader:{log:q,prefix:g},fragmentShader:{log:l,prefix:h}});t.deleteShader(H);t.deleteShader(k);var w;this.getUniforms=function(){void 0===w&&(w=new aa(t,r,a));return w};var S;this.getAttributes=function(){if(void 0===S){for(var a={},b=t.getProgramParameter(r,
t.ACTIVE_ATTRIBUTES),d=0;d<b;d++){var e=t.getActiveAttrib(r,d).name;a[e]=t.getAttribLocation(r,e)}S=a}return S};this.destroy=function(){t.deleteProgram(r);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn('THREE.WebGLProgram: .uniforms is now .getUniforms().');return this.getUniforms()}},attributes:{get:function(){console.warn('THREE.WebGLProgram: .attributes is now .getAttributes().');return this.getAttributes()}}});this.id=hg++;this.code=b;this.usedTimes=1;
this.program=r;this.vertexShader=H;this.fragmentShader=k;return this}function Bc(a,b){function t(a,t){var b;a?a.isTexture?b=a.encoding:a.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),b=a.texture.encoding):b=3E3;3E3===b&&t&&(b=3007);return b}var d=[],e={MeshDepthMaterial:'depth',MeshNormalMaterial:'normal',MeshBasicMaterial:'basic',MeshLambertMaterial:'lambert',MeshPhongMaterial:'phong',
MeshToonMaterial:'phong',MeshStandardMaterial:'physical',MeshPhysicalMaterial:'physical',LineBasicMaterial:'basic',LineDashedMaterial:'dashed',PointsMaterial:'points'},f='precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering'.split(' ');
this.getParameters=function(d,f,g,H,k,h){var q=e[d.type],l;if(h.isSkinnedMesh)if(l=h.skeleton.bones,b.floatVertexTextures)l=1024;else{var n=Math.min(Math.floor((b.maxVertexUniforms-20)/4),l.length);n<l.length?(console.warn('THREE.WebGLRenderer: Skeleton has '+l.length+' bones. This GPU supports '+n+'.'),l=0):l=n}else l=0;n=a.getPrecision();null!==d.precision&&(n=b.getMaxPrecision(d.precision),n!==d.precision&&console.warn('THREE.WebGLProgram.getParameters:',d.precision,'not supported, using',n,'instead.'));
var m=a.getRenderTarget();return{shaderID:q,precision:n,supportsVertexTextures:b.vertexTextures,outputEncoding:t(m?m.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:t(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:t(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(306===d.envMap.mapping||307===d.envMap.mapping),lightMap:!!d.lightMap,aoMap:!!d.aoMap,emissiveMap:!!d.emissiveMap,emissiveMapEncoding:t(d.emissiveMap,a.gammaInput),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,
displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,gradientMap:!!d.gradientMap,combine:d.combine,vertexColors:d.vertexColors,fog:!!g,useFog:d.fog,fogExp:g&&g.isFogExp2,flatShading:1===d.shading,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:d.skinning&&0<l,maxBones:l,useVertexTexture:b.floatVertexTextures,morphTargets:d.morphTargets,morphNormals:d.morphNormals,
maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numRectAreaLights:f.rectArea.length,numHemiLights:f.hemi.length,numClippingPlanes:H,numClipIntersection:k,dithering:d.dithering,shadowMapEnabled:a.shadowMap.enabled&&h.receiveShadow&&0<f.shadows.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,
alphaTest:d.alphaTest,doubleSided:2===d.side,flipSided:1===d.side,depthPacking:void 0!==d.depthPacking?d.depthPacking:!1}};this.getProgramCode=function(t,b){var d=[];b.shaderID?d.push(b.shaderID):(d.push(t.fragmentShader),d.push(t.vertexShader));if(void 0!==t.defines)for(var e in t.defines)d.push(e),d.push(t.defines[e]);for(e=0;e<f.length;e++)d.push(b[f[e]]);d.push(a.gammaOutput);return d.join()};this.acquireProgram=function(t,b,e){for(var f,g=0,H=d.length;g<H;g++){var k=d[g];if(k.code===e){f=k;++f.usedTimes;
break}}void 0===f&&(f=new X(a,e,t,b),d.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var t=d.indexOf(a);d[t]=d[d.length-1];d.pop();a.destroy()}};this.programs=d}function pc(a,b,d,e,f,g,k){function t(a,t){if(a.width>t||a.height>t){t/=Math.max(a.width,a.height);var b=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');b.width=Math.floor(a.width*t);b.height=Math.floor(a.height*t);b.getContext('2d').drawImage(a,0,0,a.width,a.height,0,0,b.width,b.height);console.warn('THREE.WebGLRenderer: image is too big ('+
a.width+'x'+a.height+'). Resized to '+b.width+'x'+b.height,a);return b}return a}function H(a){return Oa.isPowerOfTwo(a.width)&&Oa.isPowerOfTwo(a.height)}function h(t){return 1003===t||1004===t||1005===t?a.NEAREST:a.LINEAR}function q(t){t=t.target;t.removeEventListener('dispose',q);a:{var b=e.get(t);if(t.image&&b.__image__webglTextureCube)a.deleteTexture(b.__image__webglTextureCube);else{if(void 0===b.__webglInit)break a;a.deleteTexture(b.__webglTexture)}e.remove(t)}k.textures--}function l(t){t=t.target;
t.removeEventListener('dispose',l);var b=e.get(t),d=e.get(t.texture);if(t){void 0!==d.__webglTexture&&a.deleteTexture(d.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(d=0;6>d;d++)a.deleteFramebuffer(b.__webglFramebuffer[d]),b.__webglDepthbuffer&&a.deleteRenderbuffer(b.__webglDepthbuffer[d]);else a.deleteFramebuffer(b.__webglFramebuffer),b.__webglDepthbuffer&&a.deleteRenderbuffer(b.__webglDepthbuffer);e.remove(t.texture);e.remove(t)}k.textures--}function n(b,
h){var l=e.get(b);if(0<b.version&&l.__version!==b.version){var n=b.image;if(void 0===n)console.warn('THREE.WebGLRenderer: Texture marked for update but image is undefined',b);else if(!1===n.complete)console.warn('THREE.WebGLRenderer: Texture marked for update but image is incomplete',b);else{void 0===l.__webglInit&&(l.__webglInit=!0,b.addEventListener('dispose',q),l.__webglTexture=a.createTexture(),k.textures++);d.activeTexture(a.TEXTURE0+h);d.bindTexture(a.TEXTURE_2D,l.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,
b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);h=t(b.image,f.maxTextureSize);if((1001!==b.wrapS||1001!==b.wrapT||1003!==b.minFilter&&1006!==b.minFilter)&&!1===H(h))if(n=h,n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){var p=document.createElementNS('http://www.w3.org/1999/xhtml','canvas');p.width=Oa.nearestPowerOfTwo(n.width);p.height=Oa.nearestPowerOfTwo(n.height);p.getContext('2d').drawImage(n,0,0,p.width,
p.height);console.warn('THREE.WebGLRenderer: image is not power of two ('+n.width+'x'+n.height+'). Resized to '+p.width+'x'+p.height,n);h=p}else h=n;var n=H(h),p=g(b.format),r=g(b.type);m(a.TEXTURE_2D,b,n);var S=b.mipmaps;if(b.isDepthTexture){S=a.DEPTH_COMPONENT;if(1015===b.type){if(!w)throw Error('Float Depth Texture only supported in WebGL2.0');S=a.DEPTH_COMPONENT32F}else w&&(S=a.DEPTH_COMPONENT16);1026===b.format&&S===a.DEPTH_COMPONENT&&1012!==b.type&&1014!==b.type&&(console.warn('THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.'),
b.type=1012,r=g(b.type));1027===b.format&&(S=a.DEPTH_STENCIL,1020!==b.type&&(console.warn('THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.'),b.type=1020,r=g(b.type)));d.texImage2D(a.TEXTURE_2D,0,S,h.width,h.height,0,p,r,null)}else if(b.isDataTexture)if(0<S.length&&n){for(var u=0,x=S.length;u<x;u++)h=S[u],d.texImage2D(a.TEXTURE_2D,u,p,h.width,h.height,0,p,r,h.data);b.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,p,h.width,h.height,0,p,r,h.data);else if(b.isCompressedTexture)for(u=
0,x=S.length;u<x;u++)h=S[u],1023!==b.format&&1022!==b.format?-1<d.getCompressedTextureFormats().indexOf(p)?d.compressedTexImage2D(a.TEXTURE_2D,u,p,h.width,h.height,0,h.data):console.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()'):d.texImage2D(a.TEXTURE_2D,u,p,h.width,h.height,0,p,r,h.data);else if(0<S.length&&n){u=0;for(x=S.length;u<x;u++)h=S[u],d.texImage2D(a.TEXTURE_2D,u,p,p,r,h);b.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,p,p,r,h);
b.generateMipmaps&&n&&a.generateMipmap(a.TEXTURE_2D);l.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}}d.activeTexture(a.TEXTURE0+h);d.bindTexture(a.TEXTURE_2D,l.__webglTexture)}function m(t,d,H){H?(a.texParameteri(t,a.TEXTURE_WRAP_S,g(d.wrapS)),a.texParameteri(t,a.TEXTURE_WRAP_T,g(d.wrapT)),a.texParameteri(t,a.TEXTURE_MAG_FILTER,g(d.magFilter)),a.texParameteri(t,a.TEXTURE_MIN_FILTER,g(d.minFilter))):(a.texParameteri(t,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(t,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),
1001===d.wrapS&&1001===d.wrapT||console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.',d),a.texParameteri(t,a.TEXTURE_MAG_FILTER,h(d.magFilter)),a.texParameteri(t,a.TEXTURE_MIN_FILTER,h(d.minFilter)),1003!==d.minFilter&&1006!==d.minFilter&&console.warn('THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.',d));!(H=b.get('EXT_texture_filter_anisotropic'))||
1015===d.type&&null===b.get('OES_texture_float_linear')||1016===d.type&&null===b.get('OES_texture_half_float_linear')||!(1<d.anisotropy||e.get(d).__currentAnisotropy)||(a.texParameterf(t,H.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(d.anisotropy,f.getMaxAnisotropy())),e.get(d).__currentAnisotropy=d.anisotropy)}function p(t,b,f,H){var k=g(b.texture.format),h=g(b.texture.type);d.texImage2D(H,0,k,b.width,b.height,0,k,h,null);a.bindFramebuffer(a.FRAMEBUFFER,t);a.framebufferTexture2D(a.FRAMEBUFFER,f,H,e.get(b.texture).__webglTexture,
0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function r(t,b){a.bindRenderbuffer(a.RENDERBUFFER,t);b.depthBuffer&&!b.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,b.width,b.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t)):b.depthBuffer&&b.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,b.width,b.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t)):a.renderbufferStorage(a.RENDERBUFFER,
a.RGBA4,b.width,b.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var w='undefined'!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;this.setTexture2D=n;this.setTextureCube=function(b,h){var l=e.get(b);if(6===b.image.length)if(0<b.version&&l.__version!==b.version){l.__image__webglTextureCube||(b.addEventListener('dispose',q),l.__image__webglTextureCube=a.createTexture(),k.textures++);d.activeTexture(a.TEXTURE0+h);d.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,
b.flipY);h=b&&b.isCompressedTexture;for(var n=b.image[0]&&b.image[0].isDataTexture,p=[],r=0;6>r;r++)p[r]=h||n?n?b.image[r].image:b.image[r]:t(b.image[r],f.maxCubemapSize);var w=H(p[0]),S=g(b.format),u=g(b.type);m(a.TEXTURE_CUBE_MAP,b,w);for(r=0;6>r;r++)if(h)for(var x,Sa=p[r].mipmaps,v=0,B=Sa.length;v<B;v++)x=Sa[v],1023!==b.format&&1022!==b.format?-1<d.getCompressedTextureFormats().indexOf(S)?d.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+r,v,S,x.width,x.height,0,x.data):console.warn('THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()'):
d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+r,v,S,x.width,x.height,0,S,u,x.data);else n?d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,S,p[r].width,p[r].height,0,S,u,p[r].data):d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,S,S,u,p[r]);b.generateMipmaps&&w&&a.generateMipmap(a.TEXTURE_CUBE_MAP);l.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else d.activeTexture(a.TEXTURE0+h),d.bindTexture(a.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)};this.setTextureCubeDynamic=function(t,b){d.activeTexture(a.TEXTURE0+
b);d.bindTexture(a.TEXTURE_CUBE_MAP,e.get(t).__webglTexture)};this.setupRenderTarget=function(t){var b=e.get(t),f=e.get(t.texture);t.addEventListener('dispose',l);f.__webglTexture=a.createTexture();k.textures++;var g=!0===t.isWebGLRenderTargetCube,h=H(t);if(g){b.__webglFramebuffer=[];for(var q=0;6>q;q++)b.__webglFramebuffer[q]=a.createFramebuffer()}else b.__webglFramebuffer=a.createFramebuffer();if(g){d.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);m(a.TEXTURE_CUBE_MAP,t.texture,h);for(q=0;6>q;q++)p(b.__webglFramebuffer[q],
t,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+q);t.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);d.bindTexture(a.TEXTURE_CUBE_MAP,null)}else d.bindTexture(a.TEXTURE_2D,f.__webglTexture),m(a.TEXTURE_2D,t.texture,h),p(b.__webglFramebuffer,t,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),t.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),d.bindTexture(a.TEXTURE_2D,null);if(t.depthBuffer){b=e.get(t);f=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(f)throw Error('target.depthTexture not supported in Cube render targets');
if(t&&t.isWebGLRenderTargetCube)throw Error('Depth Texture with cube render targets is not supported!');a.bindFramebuffer(a.FRAMEBUFFER,b.__webglFramebuffer);if(!t.depthTexture||!t.depthTexture.isDepthTexture)throw Error('renderTarget.depthTexture must be an instance of THREE.DepthTexture');e.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=
!0);n(t.depthTexture,0);b=e.get(t.depthTexture).__webglTexture;if(1026===t.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,b,0);else if(1027===t.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,b,0);else throw Error('Unknown depthTexture format');}else if(f)for(b.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,b.__webglFramebuffer[f]),b.__webglDepthbuffer[f]=a.createRenderbuffer(),r(b.__webglDepthbuffer[f],
t);else a.bindFramebuffer(a.FRAMEBUFFER,b.__webglFramebuffer),b.__webglDepthbuffer=a.createRenderbuffer(),r(b.__webglDepthbuffer,t);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(t){var b=t.texture;b.generateMipmaps&&H(t)&&1003!==b.minFilter&&1006!==b.minFilter&&(t=t&&t.isWebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,b=e.get(b).__webglTexture,d.bindTexture(t,b),a.generateMipmap(t),d.bindTexture(t,null))}}function re(){var a={};return{get:function(t){t=t.uuid;
var b=a[t];void 0===b&&(b={},a[t]=b);return b},remove:function(t){delete a[t.uuid]},clear:function(){a={}}}}function Rb(a,b,d){function t(t,b,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(t,f);a.texParameteri(t,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(t,a.TEXTURE_MAG_FILTER,a.NEAREST);for(t=0;t<d;t++)a.texImage2D(b+t,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}function e(t){!0!==x[t]&&(a.enable(t),x[t]=!0)}function g(t){!1!==x[t]&&(a.disable(t),x[t]=!1)}function H(t,b,
f,H,k,h,q,l){0!==t?e(a.BLEND):g(a.BLEND);5===t||t===B&&l===E||(2===t?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):3===t?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):4===t?l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,
a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):l?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),B=t,E=l);if(5===t){k=k||b;h=h||f;q=q||H;if(b!==y||k!==C)a.blendEquationSeparate(d(b),d(k)),y=b,C=k;if(f!==A||H!==z||h!==D||q!==pa)a.blendFuncSeparate(d(f),
d(H),d(h),d(q)),A=f,z=H,D=h,pa=q}else pa=D=C=z=A=y=null}function k(t){G!==t&&(t?a.frontFace(a.CW):a.frontFace(a.CCW),G=t)}function h(t){0!==t?(e(a.CULL_FACE),t!==ia&&(1===t?a.cullFace(a.BACK):2===t?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):g(a.CULL_FACE);ia=t}function q(t,b,d){if(t){if(e(a.POLYGON_OFFSET_FILL),F!==b||N!==d)a.polygonOffset(b,d),F=b,N=d}else g(a.POLYGON_OFFSET_FILL)}function l(t){void 0===t&&(t=a.TEXTURE0+O-1);Ka!==t&&(a.activeTexture(t),Ka=t)}var n=new function(){var t=!1,
b=new f,d=null,e=new f;return{setMask:function(b){d===b||t||(a.colorMask(b,b,b,b),d=b)},setLocked:function(a){t=a},setClear:function(t,d,f,g,H){!0===H&&(t*=g,d*=g,f*=g);b.set(t,d,f,g);!1===e.equals(b)&&(a.clearColor(t,d,f,g),e.copy(b))},reset:function(){t=!1;d=null;e.set(0,0,0,1)}}},m=new function(){var t=!1,b=null,d=null,f=null;return{setTest:function(t){t?e(a.DEPTH_TEST):g(a.DEPTH_TEST)},setMask:function(d){b===d||t||(a.depthMask(d),b=d)},setFunc:function(t){if(d!==t){if(t)switch(t){case 0:a.depthFunc(a.NEVER);
break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);d=t}},setLocked:function(a){t=a},setClear:function(t){f!==t&&(a.clearDepth(t),f=t)},reset:function(){t=!1;f=d=b=null}}},p=new function(){var t=!1,b=null,d=null,f=null,H=null,k=null,h=null,q=null,
l=null;return{setTest:function(t){t?e(a.STENCIL_TEST):g(a.STENCIL_TEST)},setMask:function(d){b===d||t||(a.stencilMask(d),b=d)},setFunc:function(t,b,e){if(d!==t||f!==b||H!==e)a.stencilFunc(t,b,e),d=t,f=b,H=e},setOp:function(t,b,d){if(k!==t||h!==b||q!==d)a.stencilOp(t,b,d),k=t,h=b,q=d},setLocked:function(a){t=a},setClear:function(t){l!==t&&(a.clearStencil(t),l=t)},reset:function(){t=!1;l=q=h=k=H=f=d=b=null}}},r=a.getParameter(a.MAX_VERTEX_ATTRIBS),w=new Uint8Array(r),S=new Uint8Array(r),u=new Uint8Array(r),
x={},v=null,B=null,y=null,A=null,z=null,C=null,D=null,pa=null,E=!1,G=null,ia=null,Q=null,F=null,N=null,K=null,O=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS),r=parseFloat(/^WebGL\ ([0-9])/.exec(a.getParameter(a.VERSION))[1]),T=1<=parseFloat(r),Ka=null,I={},P=new f,L=new f,W={};W[a.TEXTURE_2D]=t(a.TEXTURE_2D,a.TEXTURE_2D,1);W[a.TEXTURE_CUBE_MAP]=t(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:n,depth:m,stencil:p},init:function(){n.setClear(0,0,0,1);m.setClear(1);p.setClear(0);
e(a.DEPTH_TEST);m.setFunc(3);k(!1);h(1);e(a.CULL_FACE);e(a.BLEND);H(1)},initAttributes:function(){for(var a=0,t=w.length;a<t;a++)w[a]=0},enableAttribute:function(t){w[t]=1;0===S[t]&&(a.enableVertexAttribArray(t),S[t]=1);0!==u[t]&&(b.get('ANGLE_instanced_arrays').vertexAttribDivisorANGLE(t,0),u[t]=0)},enableAttributeAndDivisor:function(t,d){w[t]=1;0===S[t]&&(a.enableVertexAttribArray(t),S[t]=1);u[t]!==d&&(b.get('ANGLE_instanced_arrays').vertexAttribDivisorANGLE(t,d),u[t]=d)},disableUnusedAttributes:function(){for(var t=
0,b=S.length;t!==b;++t)S[t]!==w[t]&&(a.disableVertexAttribArray(t),S[t]=0)},enable:e,disable:g,getCompressedTextureFormats:function(){if(null===v&&(v=[],b.get('WEBGL_compressed_texture_pvrtc')||b.get('WEBGL_compressed_texture_s3tc')||b.get('WEBGL_compressed_texture_etc1')))for(var t=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<t.length;d++)v.push(t[d]);return v},setBlending:H,setMaterial:function(t){2===t.side?g(a.CULL_FACE):e(a.CULL_FACE);k(1===t.side);!0===t.transparent?H(t.blending,t.blendEquation,
t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):H(0);m.setFunc(t.depthFunc);m.setTest(t.depthTest);m.setMask(t.depthWrite);n.setMask(t.colorWrite);q(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:k,setCullFace:h,setLineWidth:function(t){t!==Q&&(T&&a.lineWidth(t),Q=t)},setPolygonOffset:q,getScissorTest:func