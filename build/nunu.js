var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6-impl","es3");$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6-impl","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var h in e)$jscomp.owns(e,h)&&(a[h]=e[h])}return a}},"es6-impl","es3");function App(){}try{App.fs=require("fs"),App.gui=require("nw.gui"),App.clipboard=App.gui.Clipboard.get(),App.args=App.gui.App.argv}catch(a){App.args=[]}
App.initialize=function(a){App.fullscreen=!1;Keyboard.initialize();Mouse.initialize();App.main=a;App.main.initialize();App.delta=0;App.time=Date.now();App.loop()};App.loop=function(){requestAnimationFrame(App.loop);Mouse.update();Keyboard.update();App.delta=Date.now()-App.time;App.time+=App.delta;App.main.update();App.main.render()};App.resize=function(){App.main.resize()};
App.setFullscreen=function(a,b){(App.fullscreen=a)?(void 0===b&&(b=document.body),b.requestFullscreen=b.requestFullscreen||b.mozRequestFullScreen||b.webkitRequestFullscreen||b.msRequestFullscreen,b.requestFullscreen&&b.requestFullscreen()):(document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen,document.exitFullscreen&&document.exitFullscreen())};App.loadMain=function(a){App.main=a;App.main.initialize(App.canvas)};
App.webvrAvailable=function(){return void 0!==navigator.getVRDisplays};App.setOnExit=function(a){App.onExit=a};App.exit=function(){if(void 0!==App.onExit)App.onExit();void 0!==App.gui&&(App.gui.App.closeAllWindows(),App.gui.App.quit())};
function include(a,b){if(a.endsWith(".js")){var c=document.createElement("script");c.src=a;c.type="text/javascript";c.async=!1;b&&(c.onload=b);document.body.appendChild(c)}else if(a.endsWith(".css"))b=document.createElement("link"),b.href=a,b.rel="stylesheet",document.body.appendChild(b);else if(a.endsWith("*")){if(void 0!==App.fs){a=a.replace("*","");for(var c=App.fs.readdirSync(a),d=0;d<c.length;d++)include(a+c[d])}}else if(void 0!==App.fs){a+="/";try{for(c=App.fs.readdirSync(a),d=0;d<c.length;d++)include(a+
c[d])}catch(e){}}}
var BufferAttribute=THREE.BufferAttribute,BufferGeometry=THREE.BufferGeometry,Clock=THREE.Clock,Face3=THREE.Face3,Geometry=THREE.Geometry,Object3D=THREE.Object3D,Raycaster=THREE.Raycaster,Material=THREE.Material,LineBasicMaterial=THREE.LineBasicMaterial,LineDashedMaterial=THREE.LineDashedMaterial,MeshBasicMaterial=THREE.MeshBasicMaterial,MeshDepthMaterial=THREE.MeshDepthMaterial,MeshLambertMaterial=THREE.MeshLambertMaterial,MeshNormalMaterial=THREE.MeshNormalMaterial,MeshPhongMaterial=THREE.MeshPhongMaterial,
MeshPhysicalMaterial=THREE.MeshPhysicalMaterial,MeshStandardMaterial=THREE.MeshStandardMaterial,MultiMaterial=THREE.MultiMaterial,PointsMaterial=THREE.PointsMaterial,RawShaderMaterial=THREE.RawShaderMaterial,ShaderMaterial=THREE.ShaderMaterial,SpriteMaterial=THREE.SpriteMaterial,Box2=THREE.Box2,Box3=THREE.Box3,Color=THREE.Color,Euler=THREE.Euler,Frustum=THREE.Frustum,Matrix3=THREE.Matrix3,Matrix4=THREE.Matrix4,Plane=THREE.Plane,Quarternion=THREE.Quarternion,Ray=THREE.Ray,Sphere=THREE.Sphere,Spline=
THREE.Spline,Triangle=THREE.Triangle,Vector2=THREE.Vector2,Vector3=THREE.Vector3,Vector4=THREE.Vector4,LOD=THREE.LOD,LensFlare=THREE.LensFlare;THREE.Object3D.prototype.folded=!1;THREE.Object3D.prototype.hidden=!1;THREE.Object3D.prototype.initialize=function(){for(var a=0;a<this.children.length;a++)this.children[a].initialize()};THREE.Object3D.prototype.update=function(){for(var a=0;a<this.children.length;a++)this.children[a].update()};THREE.Object3D.prototype.dispose=function(){for(var a=0;a<this.children.length;a++)this.children[a].dispose()};
THREE.Object3D.prototype.removeAll=function(){for(var a=this.children.length-1;-1<a;a--)this.remove(this.children[a])};THREE.Object3D.prototype.destroy=function(){for(;0<this.children.length;)this.children[0].destroy();null!==this.parent&&(this.dispose&&this.dispose(),this.parent.remove(this))};
THREE.Object3D.prototype.toJSON=function(a,b){function c(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var d=void 0===a,e={};d&&(a={fonts:{},videos:{},images:{},audio:{},geometries:{},materials:{},textures:{}},e.metadata={version:Editor.VERSION,type:"NunuProgram"});var h={};h.uuid=this.uuid;h.type=this.type;h.name=this.name;h.folded=this.folded;h.hidden=this.hidden;h.castShadow=this.castShadow;h.receiveShadow=this.receiveShadow;h.visible=this.visible;h.matrixAutoUpdate=
this.matrixAutoUpdate;h.matrix=this.matrix.toArray();"{}"!==JSON.stringify(this.userData)&&(h.userData=this.userData);void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),h.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),h.material=this.material.uuid);void 0!==b&&b(a,h);if(0<this.children.length)for(h.children=[],b=0;b<
this.children.length;b++)this.children[b].hidden||h.children.push(this.children[b].toJSON(a).object);d&&(e.geometries=c(a.geometries),e.materials=c(a.materials),e.textures=c(a.textures),e.images=c(a.images),e.videos=c(a.videos),e.audio=c(a.audio),e.fonts=c(a.fonts));e.object=h;return e};THREE.Vector3.fromJSON=function(a){return new THREE.Vector3(a.x,a.y,a.z)};THREE.Vector3.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z}};
THREE.Vector2.fromJSON=function(a){return new THREE.Vector2(a.x,a.y)};THREE.Vector2.prototype.toJSON=function(){return{x:this.x,y:this.y}};THREE.Color.fromJSON=function(a){return new THREE.Color(a.r,a.g,a.b)};
THREE.Texture.prototype.toJSON=function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:Editor.VERSION,type:"Texture"},uuid:this.uuid,name:this.name,category:this.category,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};return a.textures[this.uuid]=b};
THREE.LightShadow.prototype.toJSON=function(){var a={};a.bias=this.bias;a.radius=this.radius;a.mapSize={};a.mapSize.x=this.mapSize.x;a.mapSize.y=this.mapSize.y;a.camera={};a.camera.top=this.camera.top;a.camera.bottom=this.camera.bottom;a.camera.far=this.camera.far;a.camera.near=this.camera.near;a.camera.left=this.camera.left;a.camera.right=this.camera.right;return a};
THREE.LightShadow.prototype.fromJSON=function(a){void 0!==a.bias&&(this.bias=a.bias);void 0!==a.radius&&(this.radius=a.radius);if(void 0!==a.mapSize){var b=a.mapSize;this.mapSize.set(b.x,b.y)}void 0!==a.camera&&(a=a.camera,this.camera.top=a.top,this.camera.bottom=a.bottom,this.camera.left=a.left,this.camera.right=a.right,this.camera.near=a.near,this.camera.far=a.far)};THREE.Fog.NONE=0;THREE.Fog.LINEAR=1;THREE.Fog.EXPONENTIAL=2;function Key(){this.justReleased=this.justPressed=this.isPressed=!1}
Key.KEY_DOWN=-1;Key.KEY_UP=1;Key.KEY_RESET=0;Key.prototype.update=function(a){this.justReleased=this.justPressed=!1;a===Key.KEY_DOWN?(!1===this.isPressed&&(this.justPressed=!0),this.isPressed=!0):a===Key.KEY_UP?(this.isPressed&&(this.justReleased=!0),this.isPressed=!1):a===Key.KEY_RESET&&(this.justPressed=this.justReleased=!1)};Key.prototype.set=function(a,b,c){this.justPressed=a;this.isPressed=b;this.justReleased=c};
Key.prototype.reset=function(){this.justReleased=this.isPressed=this.justPressed=!1};Key.prototype.toString=function(){return"Pressed:"+this.isPressed+" JustPressed:"+this.justPressed+" JustReleased:"+this.justReleased};function Keyboard(){}
Keyboard.initialize=function(){Keyboard.keys=[];Keyboard.actions=[];for(var a=0;256>a;a++)Keyboard.keys.push(new Key);document.onkeydown=function(a){Keyboard.actions.push(a.keyCode);Keyboard.actions.push(Key.KEY_DOWN)};document.onkeyup=function(a){Keyboard.actions.push(a.keyCode);Keyboard.actions.push(Key.KEY_UP)}};
Keyboard.update=function(){for(var a=0;Keyboard.actions.length>a;){var b=Keyboard.actions.shift(),c=Keyboard.actions.shift();Keyboard.keys[b].update(c);if(Keyboard.keys[b].justReleased||Keyboard.keys[b].justPressed)Keyboard.actions.push(b),Keyboard.actions.push(Key.KEY_RESET),a+=2}};Keyboard.reset=function(){Keyboard.actions=[];for(var a=0;a<Keyboard.keys.length;a++)Keyboard.keys[a].reset()};Keyboard.keyPressed=function(a){return 256>a&&Keyboard.keys[a].isPressed};
Keyboard.keyJustPressed=function(a){return 256>a&&Keyboard.keys[a].justPressed};Keyboard.keyJustReleased=function(a){return 256>a&&Keyboard.keys[a].justReleased};Keyboard.BACKSPACE=8;Keyboard.TAB=9;Keyboard.ENTER=13;Keyboard.SHIFT=16;Keyboard.CTRL=17;Keyboard.ALT=18;Keyboard.CAPS_LOCK=20;Keyboard.ESC=27;Keyboard.SPACEBAR=32;Keyboard.PAGE_UP=33;Keyboard.PAGE_DOWN=34;Keyboard.END=35;Keyboard.HOME=36;Keyboard.INSERT=45;Keyboard.DEL=46;Keyboard.LEFT=37;Keyboard.RIGHT=39;Keyboard.UP=38;Keyboard.DOWN=40;
Keyboard.NUM0=48;Keyboard.NUM1=49;Keyboard.NUM2=50;Keyboard.NUM3=51;Keyboard.NUM4=52;Keyboard.NUM5=53;Keyboard.NUM6=54;Keyboard.NUM7=55;Keyboard.NUM8=56;Keyboard.NUM9=57;Keyboard.A=65;Keyboard.B=66;Keyboard.C=67;Keyboard.D=68;Keyboard.E=69;Keyboard.F=70;Keyboard.G=71;Keyboard.H=72;Keyboard.I=73;Keyboard.J=74;Keyboard.K=75;Keyboard.L=76;Keyboard.M=77;Keyboard.N=78;Keyboard.O=79;Keyboard.P=80;Keyboard.Q=81;Keyboard.R=82;Keyboard.S=83;Keyboard.T=84;Keyboard.U=85;Keyboard.V=86;Keyboard.W=87;
Keyboard.X=88;Keyboard.Y=89;Keyboard.Z=90;Keyboard.F1=112;Keyboard.F2=113;Keyboard.F3=114;Keyboard.F4=115;Keyboard.F5=116;Keyboard.F6=117;Keyboard.F7=118;Keyboard.F8=119;Keyboard.F9=120;Keyboard.F10=121;Keyboard.F11=122;Keyboard.F12=123;function Mouse(){}
Mouse.initialize=function(){Mouse._keys=[];Mouse._position=new THREE.Vector2(0,0);Mouse._position_updated=!1;Mouse._delta=new THREE.Vector2(0,0);Mouse._wheel=0;Mouse._wheel_updated=!1;Mouse.keys=[];Mouse.position=new THREE.Vector2(0,0);Mouse.delta=new THREE.Vector2(0,0);Mouse.wheel=0;Mouse.canvas=null;for(var a=0;3>a;a++)Mouse._keys.push(new Key),Mouse.keys.push(new Key);void 0!==document.onmousewheel?document.addEventListener("mousewheel",function(a){Mouse._wheel=a.deltaY;Mouse._wheel_updated=!0},
!1):void 0!==document.addEventListener?document.addEventListener("DOMMouseScroll",function(a){Mouse._wheel=30*a.detail;Mouse._wheel_updated=!0},!1):document.onwheel=function(a){Mouse._wheel=a.deltaY;Mouse._wheel_updated=!0};if("ontouchstart"in window||0<navigator.msMaxTouchPoints){var b=new THREE.Vector2(0,0);document.addEventListener("touchstart",function(a){a=a.touches[0];b.set(a.clientX,a.clientY);Mouse.updateKey(Mouse.LEFT,Key.KEY_DOWN)},!1);document.addEventListener("touchend",function(a){Mouse.updateKey(Mouse.LEFT,
Key.KEY_UP)},!1);document.addEventListener("touchmove",function(a){a=a.touches[0];if(null!==Mouse.canvas){var c=Mouse.canvas.getBoundingClientRect();Mouse.updatePosition(a.clientX-c.left,a.clientY-c.top,a.clientX-b.x,a.clientY-b.y)}else Mouse.updatePosition(a.clientX,a.clientY,a.clientX-b.x,a.clientY-b.y);b.set(a.clientX,a.clientY)},!1)}else document.addEventListener("mousemove",function(a){if(null!==Mouse.canvas){var b=Mouse.canvas.getBoundingClientRect();Mouse.updatePosition(a.clientX-b.left,a.clientY-
b.top,a.movementX,a.movementY)}else Mouse.updatePosition(a.clientX,a.clientY,a.movementX,a.movementY)},!1),document.addEventListener("mousedown",function(a){Mouse.updateKey(a.which-1,Key.KEY_DOWN)},!1),document.addEventListener("mouseup",function(a){Mouse.updateKey(a.which-1,Key.KEY_UP)},!1)};Mouse.LEFT=0;Mouse.MIDDLE=1;Mouse.RIGHT=2;
Mouse.setCanvas=function(a){Mouse.canvas=a;a.mouseInside=!1;a.addEventListener("mouseenter",function(){this.mouseInside=!0},!1);a.addEventListener("mouseleave",function(){this.mouseInside=!1},!1)};Mouse.insideCanvas=function(){return null===Mouse.canvas?!1:Mouse.canvas.mouseInside};
Mouse.setLock=function(a){null!==Mouse.canvas&&(a?Mouse.canvas.requestPointerLock?Mouse.canvas.requestPointerLock():Mouse.canvas.mozRequestPointerLock?Mouse.canvas.mozRequestPointerLock():Mouse.canvas.webkitRequestPointerLock&&Mouse.canvas.webkitRequestPointerLock():document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock())};Mouse.buttonPressed=function(a){return Mouse.keys[a].isPressed};
Mouse.buttonJustPressed=function(a){return Mouse.keys[a].justPressed};Mouse.buttonJustReleased=function(a){return Mouse.keys[a].justReleased};Mouse.updatePosition=function(a,b,c,d){Mouse._position.set(a,b);Mouse._delta.x+=c;Mouse._delta.y+=d;Mouse._position_updated=!0};Mouse.updateKey=function(a,b){-1<a&&Mouse._keys[a].update(b)};
Mouse.update=function(){for(var a=0;a<Mouse._keys.length;a++)Mouse._keys[a].justPressed&&Mouse.keys[a].justPressed&&(Mouse._keys[a].justPressed=!1),Mouse._keys[a].justReleased&&Mouse.keys[a].justReleased&&(Mouse._keys[a].justReleased=!1),Mouse.keys[a].set(Mouse._keys[a].justPressed,Mouse._keys[a].isPressed,Mouse._keys[a].justReleased);Mouse._wheel_updated?(Mouse.wheel=Mouse._wheel,Mouse._wheel_updated=!1):Mouse.wheel=0;Mouse._position_updated?(Mouse.delta.x=Mouse._delta.x,Mouse.delta.y=Mouse._delta.y,
Mouse._delta.set(0,0),Mouse.position.x=Mouse._position.x,Mouse.position.y=Mouse._position.y,Mouse._position_updated=!1):(Mouse.delta.x=0,Mouse.delta.y=0)};Mouse.toString=function(){return"Pos:"+Mouse.position.x+","+Mouse.position.y+" Delta:"+Mouse.delta.toString()+"\n   Left: "+Mouse.keys[0].toString()+"\n   Middle: "+Mouse.keys[1].toString()+"\n   Right: "+Mouse.keys[2].toString()};
function VRControls(a,b){function c(a){for(var c=0;c<a.length;c++)if("VRDisplay"in window&&a[c]instanceof VRDisplay||"PositionSensorVRDevice"in window&&a[c]instanceof PositionSensorVRDevice){d.vr_input=a[c];break}d.vr_input||b&&b("VR input not available")}this.vr_input=null;this.scale=1;this.standing=!1;this.userHeight=1.6;this.object=null;void 0!==a&&(this.object=a);this.position=new THREE.Vector3;this.quaternion=new THREE.Quaternion;var d=this;void 0!==navigator.getVRDisplays&&navigator.getVRDisplays().then(c)}
VRControls.prototype.update=function(){if(null!==this.vr_input){var a=this.vr_input.getPose();null!==a.orientation&&this.quaternion.fromArray(a.orientation);null!==a.position?this.position.fromArray(a.position):this.position.set(0,0,0);this.standing&&(this.position.y+=this.userHeight);this.position.multiplyScalar(this.scale);null!==this.object&&(this.object.position.copy(this.position),this.object.quaternion.copy(this.quaternion))}};VRControls.prototype.dispose=function(){this.vr_input=null};
VRControls.prototype.resetPose=function(){null!==this.vr_input&&this.vr_input.resetPose()};VRControls.prototype.attachObject=function(a){this.object=a};
function Font(a){this.name="font";this.uuid=THREE.Math.generateUUID();this.type="Font";this.encoding=this.format="";this.data=null;if(void 0!==a)if("object"===typeof a)this.data=a,this.name=a.original_font_information.fullName,this.encoding=this.format="json";else if(this.encoding=a.split(".").pop().toLowerCase(),"json"===this.encoding)this.data=JSON.parse(FileSystem.readFile(a)),this.name=this.data.original_font_information.fullName,this.format="json";else if("ttf"===this.encoding||"otf"===this.encoding||
"ttc"===this.encoding||"otc"===this.encoding)this.data=(new TTFLoader).parse(FileSystem.readFileArrayBuffer(a)),this.name=this.data.original_font_information.fullName,this.encoding=this.format="json"}Font.prototype.isFont=!0;Font.prototype.toJSON=function(a){if(void 0!==a.fonts[this.uuid])return a.fonts[this.uuid];var b={};b.name=this.name;b.uuid=this.uuid;b.encoding=this.encoding;b.type=this.type;b.format=this.format;b.data=this.data;return a.fonts[this.uuid]=b};
Font.prototype.generateShapes=function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var d=this.data;a=String(a).split("");var e=b/d.resolution,h=0;b=[];for(var f=0;f<a.length;f++){var k;k=e;var l=h,n=d.glyphs[a[f]]||d.glyphs["?"];if(n){var v=new THREE.ShapePath,u=[],g=THREE.ShapeUtils.b2,m=THREE.ShapeUtils.b3,w,p,q,x,z,A,C,D;if(n.o)for(var r=n._cachedOutline||(n._cachedOutline=n.o.split(" ")),t=0,E=r.length;t<E;)if(q=r[t++],"m"===q&&(w=r[t++]*k+l,p=r[t++]*k,v.moveTo(w,p)),"l"===q)w=r[t++]*k+l,p=r[t++]*
k,v.lineTo(w,p);else if("q"===q){if(w=r[t++]*k+l,p=r[t++]*k,z=r[t++]*k+l,A=r[t++]*k,v.quadraticCurveTo(z,A,w,p),x=u[u.length-1]){q=x.x;x=x.y;for(var y=1;y<=c;y++){var B=y/c;g(B,q,z,w);g(B,x,A,p)}}}else if("b"===q&&(w=r[t++]*k+l,p=r[t++]*k,z=r[t++]*k+l,A=r[t++]*k,C=r[t++]*k+l,D=r[t++]*k,v.bezierCurveTo(z,A,C,D,w,p),x=u[u.length-1]))for(q=x.x,x=x.y,y=1;y<=c;y++)B=y/c,m(B,q,z,C,w),m(B,x,A,D,p);k={offset:n.ha*k,path:v}}else k=void 0;h+=k.offset;b.push(k.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,
b[d].toShapes());return c};function Video(a){this.name="video";this.uuid=THREE.Math.generateUUID();this.type="Video";this.encoding=this.format="";this.data=null;void 0!==a&&(this.encoding=a.split(".").pop().toLowerCase(),this.data="data:video/"+this.encoding+";base64,"+FileSystem.readFileBase64(a),this.format="base64")}
Video.prototype.toJSON=function(a){if(void 0!==a.videos[this.uuid])return a.videos[this.uuid];var b={};b.name=this.name;b.uuid=this.uuid;b.type=this.type;b.encoding=this.encoding;b.format=this.format;b.data=this.data;return a.videos[this.uuid]=b};
function Audio(a){this.name="audio";this.uuid=THREE.Math.generateUUID();this.type="Audio";this.encoding=this.format="";this.data=null;void 0!==a&&(this.data=FileSystem.readFileArrayBuffer(a),this.encoding=a.split(".").pop().toLowerCase(),this.format="arraybuffer")}
Audio.prototype.toJSON=function(a){if(void 0!==a.audio[this.uuid])return a.audio[this.uuid];var b={};b.name=this.name;b.uuid=this.uuid;b.type=this.type;b.encoding=this.encoding;b.data=Base64Utils.fromArraybuffer(this.data);b.format="base64";return a.audio[this.uuid]=b};
function Image(a){this.name="image";this.uuid=THREE.Math.generateUUID();this.type="Image";this.encoding=this.format="";this.data=null;void 0!==a&&(this.encoding=a.split(".").pop().toLowerCase(),"gif"===this.encoding?(this.data="data:image/"+this.encoding+";base64,"+FileSystem.readFileBase64(a),this.format="base64"):"tga"===this.encoding?(a=(new THREE.TGALoader).parse(FileSystem.readFileArrayBuffer(a)),this.encoding="jpeg",this.format="base64",this.data=a.toDataURL("image/jpeg",.8)):(this.format="url",
this.data=a))}Image.prototype.encodeData=function(){var a=document.createElement("img");a.src=this.data;var b=document.createElement("canvas");b.width=a.width;b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0,a.width,a.height);for(var d=!1,a=c.getImageData(0,0,a.width,a.height).data,c=3;c<a.length;c+=4)if(255!==a[c]){d=!0;break}d?(this.format="base64",this.encoding="png",this.data=b.toDataURL("image/png")):(this.format="base64",this.encoding="jpeg",this.data=b.toDataURL("image/jpeg",.8))};
Image.prototype.toJSON=function(a){if(void 0!==a.images[this.uuid])return a.images[this.uuid];"url"===this.format&&this.encodeData();var b={};b.name=this.name;b.uuid=this.uuid;b.type=this.type;b.encoding=this.encoding;b.format=this.format;b.data=this.data;return a.images[this.uuid]=b};
function TextTexture(a,b,c,d,e,h,f,k,l,n,v){THREE.Texture.call(this,document.createElement("canvas"),c,d,e,h,f,k,l,n,v);this.image.width=2048;this.image.height=2048;this.context=this.image.getContext("2d");this.context.font="Normal 500px Arial";this.context.textAlign="center";this.context.fillStyle="#FFFFFF";this.context.fillText("text",this.image.width/2,this.image.height/2);this.name="text";this.category="Text";this.text=a;this.font=b;this.needsUpdate=!0}TextTexture.prototype=Object.create(THREE.Texture.prototype);
function VideoTexture(a,b,c,d,e,h){function f(){a.readyState>=a.HAVE_CURRENT_DATA&&(k.needsUpdate=!0);k.disposed||requestAnimationFrame(f)}"string"===typeof a?this.video=new Video(a):a instanceof Video&&(this.video=a);THREE.Texture.call(this,document.createElement("video"),b,c,d,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,e,h);this.disposed=this.generateMipmaps=!1;this.name="video";this.category="Video";this.loop=this.autoplay=!0;this.image.autoplay=this.autoplay;this.image.loop=this.loop;
this.image.src=this.video.data;var k=this;a=this.image;f()}VideoTexture.prototype=Object.create(THREE.Texture.prototype);VideoTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};VideoTexture.prototype.toJSON=function(a){var b=THREE.Texture.prototype.toJSON.call(this,a);a=this.video.toJSON(a);b.video=a.uuid;b.loop=this.loop;b.autoplay=this.autoplay;return b};
function WebcamTexture(a,b,c,d,e,h,f){function k(){l.readyState>=l.HAVE_CURRENT_DATA&&(n.needsUpdate=!0);n.disposed||requestAnimationFrame(k)}var l=document.createElement("video");l.autoplay=!0;l.loop=!0;navigator.webkitGetUserMedia?navigator.webkitGetUserMedia({video:!0},function(a){l.src=URL.createObjectURL(a)},function(a){console.warn("WebcamTexture: No webcam available")}):navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(a){l.src=URL.createObjectURL(a)}).catch(function(a){console.warn("WebcamTexture: No webcam available")});
THREE.Texture.call(this,l,a,b,c,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,h,f);this.disposed=this.generateMipmaps=!1;this.name="webcam";this.category="Webcam";var n=this;k()}WebcamTexture.prototype=Object.create(THREE.Texture.prototype);WebcamTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};
function Texture(a,b,c,d,e,h,f,k,l,n){this.img="string"===typeof a?new Image(a):a;THREE.Texture.call(this,document.createElement("img"),b,c,d,e,h,f,k,l,n);var v=this;this.disposed=!1;this.name="texture";this.category="Image";this.image.src=this.img.data;this.image.onload=function(){v.needsUpdate=!0};if("gif"===this.img.encoding){var u=function(){v.disposed||(v.needsUpdate=!0,requestAnimationFrame(u))};u()}}Texture.prototype=Object.create(THREE.Texture.prototype);
Texture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0};Texture.prototype.toJSON=function(a){var b=THREE.Texture.prototype.toJSON.call(this,a);a=this.img.toJSON(a);b.image=a.uuid;return b};function FontLoader(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager}FontLoader.prototype.load=function(a,b,c,d){(new THREE.XHRLoader(this.manager)).load(a,function(a){b(new Font(JSON.parse(a)))},c,d)};
FontLoader.prototype.parse=function(a){if(void 0!==a.data){var b=new Font;b.name=a.name;b.uuid=a.uuid;b.format=a.format;b.encoding=a.encoding;b.data=a.data;return b}return new Font(a)};function ImageLoader(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager}ImageLoader.prototype.load=function(a,b,c,d){var e=this;(new THREE.XHRLoader(this.manager)).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)};
ImageLoader.prototype.parse=function(a,b){b=new Image;b.name=a.name;b.uuid=a.uuid;b.format=a.format;b.encoding=a.encoding;b.data=a.data;return b};function VideoLoader(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager}VideoLoader.prototype.load=function(a,b,c,d){var e=this;(new THREE.XHRLoader(this.manager)).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)};
VideoLoader.prototype.parse=function(a,b){b=new Video;b.name=a.name;b.uuid=a.uuid;b.format=a.format;b.encoding=a.encoding;b.data=a.data;return b};function AudioLoader(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager}AudioLoader.prototype.load=function(a,b,c,d){(new THREE.XHRLoader(this.manager)).load(a,function(a){self.parse(JSON.parse(a),b)},c,d)};
AudioLoader.prototype.parse=function(a){var b=new Audio;b.name=a.name;b.uuid=a.uuid;b.format=a.format;b.encoding=a.encoding;b.data=ArraybufferUtils.fromBase64(a.data);return b};function TextureLoader(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.images=[];this.videos=[];this.fonts=[]}TextureLoader.prototype.load=function(a,b,c,d){var e=this;(new THREE.XHRLoader(this.manager)).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)};
TextureLoader.prototype.parse=function(a,b){var c;c=a.category;"Video"===c?(void 0===a.video&&console.warn("TextureLoader: No video specified for",a.uuid),void 0===this.videos[a.video]&&console.warn("TextureLoader: Undefined video",a.video),c=new VideoTexture(this.videos[a.video])):"Webcam"===c?c=new WebcamTexture:(void 0===a.image&&console.warn("TextureLoader: No image specified for",a.uuid),void 0===this.images[a.image]&&console.warn("TextureLoader: Undefined image",a.image),c=new Texture(this.images[a.image]));
c.uuid=a.uuid;c.name=a.name;c.mapping=a.mapping;c.offset=new THREE.Vector2(a.offset[0],a.offset[1]);c.repeat=new THREE.Vector2(a.repeat[0],a.repeat[1]);c.wrapS=a.wrap[0];c.wrapT=a.wrap[1];c.minFilter=a.minFilter;c.magFilter=a.magFilter;c.anisotropy=a.anisotropy;c.flipY=a.flipY;void 0!==b&&b(c);return c};TextureLoader.prototype.setImages=function(a){this.images=a;return this};TextureLoader.prototype.setVideos=function(a){this.videos=a;return this};
TextureLoader.prototype.setFonts=function(a){this.fonts=a;return this};function ObjectLoader(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.texturePath=""}ObjectLoader.prototype.load=function(a,b,c,d){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var e=this;(new THREE.XHRLoader(this.manager)).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)};
ObjectLoader.prototype.parse=function(a,b){var c=this.parseGeometries(a.geometries),d=this.parseImages(a.images),e=this.parseVideos(a.videos),h=this.parseAudio(a.audio),f=this.parseFonts(a.fonts),d=this.parseTextures(a.textures,d,e),e=this.parseMaterials(a.materials,d),c=this.parseObject(a.object,c,e,d,h,f);a.animations&&(c.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(c);return c};
ObjectLoader.prototype.setTexturePath=function(a){this.texturePath=a};ObjectLoader.prototype.setCrossOrigin=function(a){this.crossOrigin=a};
ObjectLoader.prototype.parseGeometries=function(a){var b=[];if(void 0!==a)for(var c=new THREE.JSONLoader,d=new THREE.BufferGeometryLoader,e=0;e<a.length;e++){var h,f=a[e];switch(f.type){case "PlaneGeometry":case "PlaneBufferGeometry":h=new THREE[f.type](f.width,f.height,f.widthSegments,f.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":h=new THREE[f.type](f.width,f.height,f.depth,f.widthSegments,f.heightSegments,f.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":h=
new THREE[f.type](f.radius,f.segments,f.thetaStart,f.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":h=new THREE[f.type](f.radiusTop,f.radiusBottom,f.height,f.radialSegments,f.heightSegments,f.openEnded,f.thetaStart,f.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":h=new THREE[f.type](f.radius,f.height,f.radialSegments,f.heightSegments,f.openEnded,f.thetaStart,f.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":h=new THREE[f.type](f.radius,
f.widthSegments,f.heightSegments,f.phiStart,f.phiLength,f.thetaStart,f.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":h=new THREE[f.type](f.radius,f.detail);break;case "RingGeometry":case "RingBufferGeometry":h=new THREE[f.type](f.innerRadius,f.outerRadius,f.thetaSegments,f.phiSegments,f.thetaStart,f.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":h=new THREE[f.type](f.radius,f.tube,f.radialSegments,
f.tubularSegments,f.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":h=new THREE[f.type](f.radius,f.tube,f.tubularSegments,f.radialSegments,f.p,f.q);break;case "LatheGeometry":case "LatheBufferGeometry":h=new THREE[f.type](f.points,f.segments,f.phiStart,f.phiLength);break;case "BufferGeometry":h=d.parse(f);break;case "Geometry":h=c.parse(f.data,this.texturePath).geometry;break;default:console.warn("ObjectLoader: Unsupported geometry type "+f.type);continue}h.uuid=f.uuid;h.name=void 0!==
f.name?f.name:"geometry";b[f.uuid]=h}return b};ObjectLoader.prototype.parseMaterials=function(a,b){var c=[],d=new THREE.MaterialLoader;d.setTextures(b);if(void 0!==a)for(b=0;b<a.length;b++){var e=d.parse(a[b]);c[e.uuid]=e}return c};ObjectLoader.prototype.parseAnimations=function(a){for(var b=[],c=0;c<a.length;c++){var d=THREE.AnimationClip.parse(a[c]);b.push(d)}return b};
ObjectLoader.prototype.parseImages=function(a){var b=new ImageLoader,c=[];if(void 0!==a)for(var d=0;d<a.length;d++)c[a[d].uuid]=b.parse(a[d]);return c};ObjectLoader.prototype.parseVideos=function(a){var b=new VideoLoader,c=[];if(void 0!==a)for(var d=0;d<a.length;d++)c[a[d].uuid]=b.parse(a[d]);return c};ObjectLoader.prototype.parseAudio=function(a){var b=new AudioLoader,c=[];if(void 0!==a)for(var d=0;d<a.length;d++)c[a[d].uuid]=b.parse(a[d]);return c};
ObjectLoader.prototype.parseFonts=function(a){var b=new FontLoader,c=[];if(void 0!==a)for(var d=0;d<a.length;d++)c[a[d].uuid]=b.parse(a[d]);return c};ObjectLoader.prototype.parseTextures=function(a,b,c){var d=new TextureLoader;d.setImages(b);d.setVideos(c);b=[];if(void 0!==a)for(c=0;c<a.length;c++){var e=d.parse(a[c]);b[e.uuid]=e}return b};
ObjectLoader.prototype.parseObject=function(a,b,c,d,e,h){function f(a){void 0===d[a]&&console.warn("ObjectLoader: Undefined texture",a);return d[a]}function k(a){void 0===b[a]&&console.warn("ObjectLoader: Undefined geometry",a);return b[a]}function l(a){void 0===c[a]&&console.warn("ObjectLoader: Undefined material",a);return c[a]}function n(a){void 0===h[a]&&console.warn("ObjectLoader: Undefined font",a);return h[a]}function v(a){void 0===e[a]&&console.warn("ObjectLoader: Undefined audio",a);return e[a]}
var u=new THREE.Matrix4,g;switch(a.type){case "SpineAnimation":for(var m=0;m<a.textures.length;m++)a.textures[m].texture=f(a.textures[m].texture);g=new SpineAnimation(a.json,a.atlas,"",a.textures);break;case "Audio":g=new AudioEmitter(v(a.audio));g.autoplay=a.autoplay;g.startTime=a.startTime;g.playbackRate=a.playbackRate;g.source.loop=a.source.loop;break;case "Physics":g=new PhysicsObject;g.body.type=a.body.type;g.body.mass=a.body.mass;g.body.linearDamping=a.body.linearDamping;g.body.angularDamping=
a.body.angularDamping;g.body.allowSleep=a.body.allowSleep;g.body.sleepSpeedLimit=a.body.sleepSpeedLimit;g.body.sleepTimeLimit=a.body.sleepTimeLimit;g.body.collisionFilterGroup=a.body.collisionFilterGroup;g.body.collisionFilterMask=a.body.collisionFilterMask;g.body.fixedRotation=a.body.fixedRotation;for(var w=a.body.shapes,m=0;m<w.length;m++){var p=w[m];p.type===CANNON.Shape.types.SPHERE?g.body.addShape(new CANNON.Sphere(p.radius)):p.type===CANNON.Shape.types.BOX?g.body.addShape(new CANNON.Box(new CANNON.Vec3(p.halfExtents.x,
p.halfExtents.y,p.halfExtents.z))):p.type===CANNON.Shape.types.PARTICLE?g.body.addShape(new CANNON.Particle):p.type===CANNON.Shape.types.PLANE?g.body.addShape(new CANNON.Plane):p.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&g.body.addShape(new CANNON.ConvexPolyhedron(p.vertices,p.faces))}break;case "ParticleEmiter":void 0!==a.group&&(g=a.group,g.texture.value=f(g.texture.value),g.textureFrames=THREE.Vector2(g.textureFrames));if(void 0!==a.emitter)for(g=a.emitter,g.position.value=THREE.Vector3.fromJSON(g.position.value),
g.position.spread=THREE.Vector3.fromJSON(g.position.spread),g.velocity.value=THREE.Vector3.fromJSON(g.velocity.value),g.velocity.spread=THREE.Vector3.fromJSON(g.velocity.spread),g.acceleration.value=THREE.Vector3.fromJSON(g.acceleration.value),g.acceleration.spread=THREE.Vector3.fromJSON(g.acceleration.spread),m=0;m<g.color.value.length;m++)g.color.value[m]=THREE.Color.fromJSON(g.color.value[m]),g.color.spread[m]=THREE.Vector3.fromJSON(g.color.spread[m]);g=new ParticleEmitter(a.group,a.emitter);break;
case "Text3D":g=new Text3D(a.text,l(a.material),n(a.font));break;case "Program":g=new Program(a.name);g.description=a.description;g.author=a.author;g.version=a.version;g.vr=a.vr;g.vr_scale=a.vr_scale;void 0!==a.lock_pointer&&(g.lock_pointer=a.lock_pointer);void 0!==a.default_scene&&(g.default_scene=a.default_scene);break;case "LeapDevice":g=new LeapMotion;g.mode=a.mode;g.use_arm=a.use_arm;void 0!==a.debug_model&&(g.debug_model=a.debug_model);void 0!==a.gestures_enabled&&(g.gestures_enabled=a.gestures_enabled);
void 0!==a.poses_enabled&&(g.poses_enabled=a.poses_enabled);break;case "Kinect":g=new KinectDevice;void 0!==a.debug_model&&(g.debug_model=a.debug_model);break;case "Sky":g=new Sky(a.auto_update,a.day_time,a.sun_distance,a.time);void 0!==a.sun&&g.sun.shadow.fromJSON(a.sun.shadow);break;case "Scene":g=new Scene;void 0!==a.background&&Number.isInteger(a.background)&&(g.background=new THREE.Color(a.background));void 0!==a.fog&&("Fog"===a.fog.type?g.fog=new THREE.Fog(a.fog.color,a.fog.near,a.fog.far):
"FogExp2"===a.fog.type&&(g.fog=new THREE.FogExp2(a.fog.color,a.fog.density)));void 0!==a.cameras&&(g.cameras=a.cameras);void 0!==a.world&&g.world.gravity.set(a.world.gravity.x,a.world.gravity.y,a.world.gravity.z);break;case "PerspectiveCamera":g=new PerspectiveCamera(a.fov,a.aspect,a.near,a.far);void 0!==a.focus&&(g.focus=a.focus);void 0!==a.zoom&&(g.zoom=a.zoom);void 0!==a.filmGauge&&(g.filmGauge=a.filmGauge);void 0!==a.filmOffset&&(g.filmOffset=a.filmOffset);void 0!==a.view&&(g.view=Object.assign({},
a.view));void 0!==a.viewport&&g.viewport.fromArray(a.viewport);void 0!==a.offset&&g.offset.fromArray(a.offset);void 0!==a.clear_color&&(g.clear_color=a.clear_color);void 0!==a.clear_depth&&(g.clear_depth=a.clear_depth);break;case "OrthographicCamera":g=new OrthographicCamera(a.size,a.aspect,a.mode,a.near,a.far);void 0!==a.viewport&&g.viewport.fromArray(a.viewport);void 0!==a.offset&&g.offset.fromArray(a.offset);void 0!==a.clear_color&&(g.clear_color=a.clear_color);void 0!==a.clear_depth&&(g.clear_depth=
a.clear_depth);break;case "Script":g=new Script(a.code);break;case "AmbientLight":g=new AmbientLight(a.color,a.intensity);break;case "DirectionalLight":g=new DirectionalLight(a.color,a.intensity);break;case "PointLight":g=new PointLight(a.color,a.intensity,a.distance,a.decay);break;case "SpotLight":g=new SpotLight(a.color,a.intensity,a.distance,a.angle,a.penumbra,a.decay);break;case "HemisphereLight":g=new HemisphereLight(a.color,a.groundColor,a.intensity);break;case "Mesh":g=new Mesh(k(a.geometry),
l(a.material));break;case "SkinnedMesh":g=new SkinnedMesh(k(a.geometry),l(a.material));break;case "LOD":g=new THREE.LOD;break;case "Line":g=new THREE.Line(k(a.geometry),l(a.material),a.mode);break;case "PointCloud":case "Points":g=new THREE.Points(k(a.geometry),l(a.material));break;case "Sprite":g=new Sprite(l(a.material));break;case "Group":g=new Container;break;case "Bone":g=new Bone;break;default:g=new Container}g.uuid=a.uuid;void 0!==a.name&&(g.name=a.name);void 0!==a.hidden&&(g.hidden=a.hidden);
void 0!==a.folded&&(g.folded=a.folded);void 0!==a.matrix?(u.fromArray(a.matrix),u.decompose(g.position,g.quaternion,g.scale)):(void 0!==a.position&&g.position.fromArray(a.position),void 0!==a.rotation&&g.rotation.fromArray(a.rotation),void 0!==a.scale&&g.scale.fromArray(a.scale));void 0!==a.castShadow&&(g.castShadow=a.castShadow);void 0!==a.receiveShadow&&(g.receiveShadow=a.receiveShadow);void 0!==a.shadow&&g.shadow.fromJSON(a.shadow);void 0!==a.visible&&(g.visible=a.visible);void 0!==a.userData&&
(g.userData=a.userData);if(void 0!==a.children)for(var q in a.children)g.add(this.parseObject(a.children[q],b,c,d,e,h));void 0!==a.matrixAutoUpdate&&(g.matrixAutoUpdate=a.matrixAutoUpdate,g.matrixAutoUpdate||(g.updateMatrix(),g.updateMatrixWorld(!0)));if("Program"===a.type)g.materials=c;else if("Scene"===a.type)for(m=0;m<g.cameras.length;m++)q=g.getCamera(g.cameras[m]),null!==q?g.cameras[m]=q:g.cameras.splice(m,1);else if("LOD"===a.type)for(a=a.levels,u=0;u<a.length;u++)m=a[u],q=g.getObjectByProperty("uuid",
m.object),void 0!==q&&g.addLevel(q,m.distance);return g};function TTFLoader(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager;this.reversed=!1}TTFLoader.prototype.load=function(a,b,c,d){var e=new THREE.XHRLoader(this.manager);e.setResponseType("arraybuffer");e.load(a,function(a){a=scope.parse(a);void 0!==b&&b(a)},c,d)};TTFLoader.prototype.parse=function(a){a=opentype.parse(a);return TTFLoader.convert(a,this.reversed)};
TTFLoader.convert=function(a,b){for(var c=1E5/(72*(a.unitsPerEm||2048)),d={glyphs:{}},e=0;e<a.glyphs.length;e++){var h=a.glyphs.glyphs[e];if(void 0!==h.unicode){var f={};f.ha=Math.round(h.advanceWidth*c);f.x_min=Math.round(h.xMin*c);f.x_max=Math.round(h.xMax*c);f.o="";b&&(h.path.commands=TTFLoader.reverseCommands(h.path.commands));h.path.commands.forEach(function(a,b){"c"===a.type.toLowerCase()&&(a.type="b");f.o+=a.type.toLowerCase();f.o+=" ";void 0!==a.x&&void 0!==a.y&&(f.o+=Math.round(a.x*c),f.o+=
" ",f.o+=Math.round(a.y*c),f.o+=" ");void 0!==a.x1&&void 0!==a.y1&&(f.o+=Math.round(a.x1*c),f.o+=" ",f.o+=Math.round(a.y1*c),f.o+=" ");void 0!==a.x2&&void 0!==a.y2&&(f.o+=Math.round(a.x2*c),f.o+=" ",f.o+=Math.round(a.y2*c),f.o+=" ")});d.glyphs[String.fromCharCode(h.unicode)]=f}}d.familyName=a.familyName;d.ascender=Math.round(a.ascender*c);d.descender=Math.round(a.descender*c);d.underlinePosition=a.tables.post.underlinePosition;d.underlineThickness=a.tables.post.underlineThickness;d.boundingBox={yMin:a.tables.head.yMin,
xMin:a.tables.head.xMin,yMax:a.tables.head.yMax,xMax:a.tables.head.xMax};d.resolution=1E3;d.original_font_information=a.tables.name;return d};
TTFLoader.reverseCommands=function(a){var b=[],c;a.forEach(function(a){"m"===a.type.toLowerCase()?(c=[a],b.push(c)):"z"!==a.type.toLowerCase()&&c.push(a)});var d=[];b.forEach(function(a){var b={type:"m",x:a[a.length-1].x,y:a[a.length-1].y};d.push(b);for(var c=a.length-1;0<c;c--){var e=a[c],b={type:e.type};void 0!==e.x2&&void 0!==e.y2?(b.x1=e.x2,b.y1=e.y2,b.x2=e.x1,b.y2=e.y1):void 0!==e.x1&&void 0!==e.y1&&(b.x1=e.x1,b.y1=e.y1);b.x=a[c-1].x;b.y=a[c-1].y;d.push(b)}});return d};
function LeapMotion(){THREE.Object3D.call(this);this.type="LeapDevice";this.name="leap";this.poses_enabled=this.gestures_enabled=this.debug_model=!0;this.mode=LeapMotion.DESK;this.use_arm=!1;this.bone_meshes=[];this.arm_meshes=[];this.material=new THREE.MeshPhongMaterial;this.geometry=new THREE.BoxBufferGeometry(1,1,1);this.physics_world=null;this.physics_bodys=[];this.gesture=[];for(var a=0;10>a;a++)this.gesture[a]=!1;this.pose=[];for(a=0;3>a;a++)this.pose[a]=!1;this.data=null}
LeapMotion.prototype=Object.create(THREE.Object3D.prototype);LeapMotion.DESK=0;LeapMotion.HDM=1;LeapMotion.SWIPE=0;LeapMotion.SWIPE_LEFT=1;LeapMotion.SWIPE_RIGHT=2;LeapMotion.SWIPE_FRONT=3;LeapMotion.SWIPE_BACK=4;LeapMotion.SWIPE_UP=5;LeapMotion.SWIPE_DOWN=6;LeapMotion.CIRCLE=7;LeapMotion.SCREEN_TAP=8;LeapMotion.KEY_TAP=9;LeapMotion.CLOSED=0;LeapMotion.OPEN=1;LeapMotion.POINTING=2;
LeapMotion.prototype.initialize=function(){var a=this;Leap.loop({background:!0},function(b){a.data=b}).connect();for(var b=0;b<this.children.length;b++)this.children[b].initialize()};LeapMotion.prototype.update=function(){null!==this.data&&(this.gestures_enabled&&this.updateGestures(),this.poses_enabled&&this.updatePoses(),this.debug_model&&this.updateDebugModel());for(var a=0;a<this.children.length;a++)this.children[a].update()};
LeapMotion.prototype.checkGesture=function(a){return void 0!==this.gesture[a]?this.gesture[a]:!1};LeapMotion.prototype.checkPose=function(a){return void 0!==this.pose[a]?this.pose[a]:!1};LeapMotion.prototype.setMode=function(a){this.mode=a};
LeapMotion.prototype.updatePoses=function(){for(var a=0;a<this.pose.length;a++)this.pose[a]=!0;for(var b=0;b<this.data.hands.length;b++){for(var c=this.data.hands[b],d=c.sphereCenter,d=new THREE.Vector3(d[0],d[1],d[2]),e=[],h=0,f,a=0;a<this.pose.length;a++)this.pose[a]=!0;for(var k=[],a=0;a<c.fingers.length;a++)f=c.fingers[a],k.push(f.direction),f=f.distal.nextJoint,f=new THREE.Vector3(f[0],f[1],f[2]),e.push(d.distanceTo(f)/c._scaleFactor),0!==a&&(.3>k[a][2]&&(this.pose[LeapMotion.CLOSED]=!1),-.5<
k[a][2]&&(this.pose[LeapMotion.OPEN]=!1),1===a?h=e[1]:h<2*e[a]-15&&(this.pose[LeapMotion.POINTING]=!1));h<2*e[0]-15&&(this.pose[LeapMotion.POINTING]=!1)}};
LeapMotion.prototype.updateGestures=function(){for(var a=0;a<this.gesture.length;a++)this.gesture[a]=!1;var b=this;this.data.valid&&0<this.data.gestures.length&&this.data.gestures.forEach(function(a){"swipe"===a.type?(b.gesture[LeapMotion.SWIPE]=!0,0<a.direction[0]?b.gesture[LeapMotion.SWIPE_RIGHT]=!0:b.gesture[LeapMotion.SWIPE_LEFT]=!0,0<a.direction[1]?b.gesture[LeapMotion.SWIPE_UP]=!0:b.gesture[LeapMotion.SWIPE_DOWN]=!0,0<a.direction[2]?b.gesture[LeapMotion.SWIPE_FRONT]=!0:b.gesture[LeapMotion.SWIPE_BACK]=
!0):"circle"===a.type?b.gesture[LeapMotion.CIRCLE]=!0:"keyTap"===a.type?b.gesture[LeapMotion.KEY_TAP]=!0:"screenTap"===a.type&&(b.gesture[LeapMotion.SCREEN_TAP]=!0)})};
LeapMotion.prototype.updateDebugModel=function(){var a=this;this.arm_meshes.forEach(function(b){a.remove(b)});this.bone_meshes.forEach(function(b){a.remove(b)});for(var b=0,c=0,d=$jscomp.makeIterator(this.data.hands),e=d.next();!e.done;e=d.next()){for(var e=e.value,h=$jscomp.makeIterator(e.fingers),f=h.next();!f.done;f=h.next())for(var f=$jscomp.makeIterator(f.value.bones),k=f.next();!k.done;k=f.next()){k=k.value;if(0!==b){var l=this.bone_meshes[b]||this.addMesh(this.bone_meshes);this.updateMesh(k,
l)}b++}this.show_arm&&(e=e.arm,h=this.arm_meshes[c++]||this.addMesh(this.arm_meshes),this.updateMesh(e,h),h.scale.set(e.width/1200,e.width/300,e.length/150))}null!==this.physics_world&&this.updatePhysics()};
LeapMotion.prototype.updatePhysics=function(){for(var a=0;a<this.physics_bodys.length;a++)this.physics_world.removeBody(this.physics_bodys[a].pop());this.children.forEach(function(a,c){a=new THREE.BoundingBoxHelper(a);a.update();c=new THREE.Vector3(a.box.max.x-a.box.min.x,a.box.max.y-a.box.min.y,a.box.max.z-a.box.min.z);c.x*=this.scale.x;c.y*=this.scale.y;c.z*=this.scale.z;c.divideScalar(2);a=a.box.center();a.x*=this.scale.x;a.y*=this.scale.y;a.z*=this.scale.z;a.add(this.position);c=new CANNON.Box(new CANNON.Vec3(c.x,
c.y,c.z));var b=new CANNON.Body({mass:0});b.addShape(c);b.position.set(a.x-this.position.x,a.y-this.position.y,a.z-this.position.z);b.updateMassProperties();this.physics_bodys.push(b);this.physics_world.addBody(b)})};LeapMotion.prototype.addMesh=function(a){var b=new Mesh(this.geometry,this.material);b.castShadow=this.castShadow;b.receiveShadow=this.receiveShadow;a.push(b);return b};
LeapMotion.prototype.updateMesh=function(a,b){b.position.fromArray(a.center());b.position.divideScalar(150);b.setRotationFromMatrix((new THREE.Matrix4).fromArray(a.matrix()));b.scale.set(a.width/150,a.width/150,a.length/150);this.add(b)};LeapMotion.prototype.getMovement=function(){var a=this.data.gestures[0].position,b=this.data.gestures[0].startPosition,a=new THREE.Vector3(a[0]-b[0],a[1]-b[1],a[2]-b[2]);a.divideScalar(this.data.currentFrameRate);return a};
LeapMotion.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.type=this.type;a.object.debug_model=this.debug_model;a.object.gestures_enabled=this.gestures_enabled;a.object.poses_enabled=this.poses_enabled;a.object.mode=this.mode;a.object.use_arm=this.use_arm;return a};
function KinectDevice(){THREE.Object3D.call(this);this.type="Kinect";this.name="kinect";this.socket=new WebSocket("ws://127.0.0.1:8181");this.connected=!1;this.debug_model=!0;this.data_timeout=0;this.data=this.camera=null;this.data_received=!1;var a=this;this.socket.onopen=function(){a.connected=!0};this.socket.onclose=function(){a.connected=!1};this.socket.onmessage=function(b){"string"===typeof b.data?(a.data=JSON.parse(b.data),a.data_received=!0,a.data_timeout=KinectDevice.DATA_TIMEOUT):b.data instanceof
Blob&&(a.camera=b.data)}}KinectDevice.DATA_TIMEOUT=20;KinectDevice.DEPTH=0;KinectDevice.COLOR=1;
KinectDevice.JOINTS_NAME=[["head","shouldercenter"],["shouldercenter","shoulderright"],["shouldercenter","shoulderleft"],["shoulderright","elbowright"],["shoulderleft","elbowleft"],["elbowright","wristright"],["elbowleft","wristleft"],["wristright","handright"],["wristleft","handleft"],["shouldercenter","spine"],["spine","hipcenter"],["hipcenter","hipright"],["hipcenter","hipleft"],["hipright","kneeright"],["hipleft","kneeleft"],["kneeright","ankleright"],["kneeleft","ankleleft"],["ankleright","footright"],
["ankleleft","footleft"]];KinectDevice.prototype=Object.create(THREE.Object3D.prototype);
KinectDevice.prototype.update=function(){if(null!==this.data)if(this.data_received){for(this.data_received=!1;0<this.children.length;)this.children.pop();if(this.debug_model)for(var a=new THREE.SphereGeometry(.04,6,6),b=new THREE.MeshPhongMaterial(16711680),c=0;c<this.data.skeletons.length;c++)for(var d=this.data.skeletons[c].joints,e=0;e<d.length;e++){var h=new Mesh(a,b);h.position.set(d[e].x,d[e].y,d[e].z);h.castShadow=!0;this.add(h)}}else if(0<this.data_timeout&&(this.data_timeout--,0===this.data_timeout))for(;0<
this.children.length;)this.children.pop();for(e=0;e<this.children.length;e++)this.children[e].update()};KinectDevice.prototype.isConnected=function(){return this.connected};KinectDevice.prototype.setCameraMode=function(a){a===KinectDevice.COLOR?socket.send("Color"):a===KinectDevice.DEPTH&&socket.send("Depth")};KinectDevice.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.debug_model=this.debug_model;return a};
function Mesh(a,b){THREE.Mesh.call(this,a,b);this.name="model";this.castShadow=this.receiveShadow=!0}Mesh.prototype=Object.create(THREE.Mesh.prototype);Mesh.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var a=0;a<this.children.length;a++)this.children[a].dispose()};function SkinnedMesh(a,b,c){THREE.SkinnedMesh.call(this,a,b,c);this.name="model";this.castShadow=this.receiveShadow=!0}SkinnedMesh.prototype=Object.create(THREE.SkinnedMesh.prototype);
SkinnedMesh.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var a=0;a<this.children.length;a++)this.children[a].dispose()};function Text3D(a,b,c){THREE.Mesh.call(this,new THREE.TextGeometry(a,{font:c}),b);this.name="text";this.type="Text3D";this.scale.set(.02,.02,.02);this.font=c;this.text=a;this.height=50;this.bevel=!1;this.bevel_thickness=10;this.bevel_size=8;this.castShadow=this.receiveShadow=!0}Text3D.prototype=Object.create(THREE.Mesh.prototype);
Text3D.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var a=0;a<this.children.length;a++)this.children[a].dispose()};Text3D.prototype.setText=function(a){this.text=a;this.geometry.dispose();this.geometry=new THREE.TextGeometry(this.text,{font:this.font,height:this.height,bevelEnabled:this.bevel,bevelSize:this.bevel_size,bevelThickness:this.bevel_thickness})};
Text3D.prototype.toJSON=function(a){var b=this.geometry;this.geometry=void 0;var c=this.font;a=THREE.Object3D.prototype.toJSON.call(this,a,function(a,b){c=c.toJSON(a)});a.object.text=this.text;a.object.font=c.uuid;a.object.height=this.height;a.object.bevel=this.bevel;a.object.bevel_thickness=this.bevel_thickness;a.object.bevel_size=this.bevel_size;this.geometry=b;return a};function Sprite(a){THREE.Sprite.call(this,a);this.name="sprite";this.type="Sprite"}Sprite.prototype=Object.create(THREE.Sprite.prototype);
Sprite.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();for(var a=0;a<this.children.length;a++)this.children[a].dispose()};function PointLight(a,b,c,d){THREE.PointLight.call(this,a,b,c,d);this.name="point_light";this.castShadow=!0;this.shadow.camera.near=.05;this.shadow.camera.far=5E3;this.shadow.bias=.01}PointLight.prototype=Object.create(THREE.PointLight.prototype);
PointLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function SpotLight(a,b,c,d,e,h){THREE.SpotLight.call(this,a,b,c,d,e,h);this.name="spot_light";this.castShadow=!0;this.shadow.camera.near=.05;this.shadow.camera.far=5E3;this.shadow.mapSize.width=512;this.shadow.mapSize.height=512}SpotLight.prototype=Object.create(THREE.SpotLight.prototype);
SpotLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function AmbientLight(a){THREE.AmbientLight.call(this,a);this.name="ambient_light";this.matrixAutoUpdate=!1}AmbientLight.prototype=Object.create(THREE.AmbientLight.prototype);function DirectionalLight(a,b){THREE.DirectionalLight.call(this,a,b);this.name="directional_light";this.castShadow=!0;this.shadow.camera.near=.5;this.shadow.camera.far=1E4}
DirectionalLight.prototype=Object.create(THREE.DirectionalLight.prototype);DirectionalLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function HemisphereLight(a,b,c){THREE.HemisphereLight.call(this,a,b,c);this.name="hemisphere_light"}HemisphereLight.prototype=Object.create(THREE.HemisphereLight.prototype);
function Sky(a,b,c,d){THREE.Object3D.call(this);this.name="sky";this.type="Sky";this.clock=new THREE.Clock;this.hemisphere=new HemisphereLight(16777215,16777215,.5);this.hemisphere.color.setHSL(.6,1,.6);this.hemisphere.groundColor.setHSL(.1,1,.75);this.hemisphere.position.set(0,500,0);this.hemisphere.hidden=!0;this.hemisphere.matrixAutoUpdate=!1;this.add(this.hemisphere);this.sun=new DirectionalLight(Sky.sun_color,.3);this.sun.castShadow=!0;this.sun.hidden=!0;this.add(this.sun);var e={top_color:{type:"c",
value:new THREE.Color(0,.46,1)},bottom_color:{type:"c",value:new THREE.Color(1,1,1)},offset:{type:"f",value:20},exponent:{type:"f",value:.4}};e.top_color.value.copy(this.hemisphere.color);var h=new THREE.SphereBufferGeometry(1E3,16,16),e=new THREE.ShaderMaterial({vertexShader:"varying vec3 vWorldPosition; \r\n\tvoid main() \r\n\t{ \r\n\t\tvec4 worldPosition = modelMatrix * vec4(position, 1.0); \r\n\t\tvWorldPosition = worldPosition.xyz; \r\n\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \r\n\t}",
fragmentShader:"uniform vec3 top_color; \r\n\tuniform vec3 bottom_color; \r\n\tuniform float offset; \r\n\tuniform float exponent; \r\n\tvarying vec3 vWorldPosition; \r\n\tvoid main() \r\n\t{ \r\n\t\tfloat h = normalize(vWorldPosition + offset).y; \r\n\t\tgl_FragColor = vec4(mix(bottom_color, top_color, max(pow(max(h , 0.0), exponent), 0.0)), 1.0); \r\n\t}",uniforms:e,side:THREE.BackSide});this.sky=new THREE.Mesh(h,e);this.sky.hidden=!0;this.sky.matrixAutoUpdate=!1;this.add(this.sky);this.sky.raycast=
function(){return null};this.auto_update=void 0!==a?a:!0;this.sun_distance=void 0!==c?c:500;this.day_time=void 0!==b?b:240;this.time=void 0!==d?d:150;this.updateSky()}Sky.prototype=Object.create(THREE.Object3D.prototype);Sky.color_top=[new THREE.Color(7844859),new THREE.Color(30463),new THREE.Color(220086),new THREE.Color(9273)];Sky.color_bottom=[new THREE.Color(15461606),new THREE.Color(16777215),new THREE.Color(16705495),new THREE.Color(26023)];Sky.sun_color=16777130;Sky.moon_color=8947967;
Sky.prototype.initialize=function(){this.updateSky();for(var a=0;a<this.children.length;a++)this.children[a].initialize()};Sky.prototype.update=function(){this.auto_update&&(this.time+=this.clock.getDelta(),this.time>this.day_time&&(this.time-=this.day_time),this.updateSky());for(var a=0;a<this.children.length;a++)this.children[a].update()};
Sky.prototype.updateSky=function(){var a=this.time/this.day_time;if(.25>a)this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[3].r,Sky.color_top[3].g,Sky.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[3].r,Sky.color_bottom[3].g,Sky.color_bottom[3].b);else if(.292>a){var b=23.81*(a-.25),c=1-b;this.sky.material.uniforms.top_color.value.setRGB(c*Sky.color_top[3].r+b*Sky.color_top[0].r,c*Sky.color_top[3].g+b*Sky.color_top[0].g,c*Sky.color_top[3].b+b*
Sky.color_top[0].b);this.sky.material.uniforms.bottom_color.value.setRGB(c*Sky.color_bottom[3].r+b*Sky.color_bottom[0].r,c*Sky.color_bottom[3].g+b*Sky.color_bottom[0].g,c*Sky.color_bottom[3].b+b*Sky.color_bottom[0].b)}else.4167>a?(this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[0].r,Sky.color_top[0].g,Sky.color_top[0].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[0].r,Sky.color_bottom[0].g,Sky.color_bottom[0].b)):.5>a?(b=12*(a-.4167),c=1-b,this.sky.material.uniforms.top_color.value.setRGB(c*
Sky.color_top[0].r+b*Sky.color_top[1].r,c*Sky.color_top[0].g+b*Sky.color_top[1].g,c*Sky.color_top[0].b+b*Sky.color_top[1].b),this.sky.material.uniforms.bottom_color.value.setRGB(c*Sky.color_bottom[0].r+b*Sky.color_bottom[1].r,c*Sky.color_bottom[0].g+b*Sky.color_bottom[1].g,c*Sky.color_bottom[0].b+b*Sky.color_bottom[1].b)):.708>a?(this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[1].r,Sky.color_top[1].g,Sky.color_top[1].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[1].r,
Sky.color_bottom[1].g,Sky.color_bottom[1].b)):.75>a?(b=23.81*(a-.708),c=1-b,this.sky.material.uniforms.top_color.value.setRGB(c*Sky.color_top[1].r+b*Sky.color_top[2].r,c*Sky.color_top[1].g+b*Sky.color_top[2].g,c*Sky.color_top[1].b+b*Sky.color_top[2].b),this.sky.material.uniforms.bottom_color.value.setRGB(c*Sky.color_bottom[1].r+b*Sky.color_bottom[2].r,c*Sky.color_bottom[1].g+b*Sky.color_bottom[2].g,c*Sky.color_bottom[1].b+b*Sky.color_bottom[2].b)):.8333>a?(b=12.048*(a-.75),c=1-b,this.sky.material.uniforms.top_color.value.setRGB(c*
Sky.color_top[2].r+b*Sky.color_top[3].r,c*Sky.color_top[2].g+b*Sky.color_top[3].g,c*Sky.color_top[2].b+b*Sky.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(c*Sky.color_bottom[2].r+b*Sky.color_bottom[3].r,c*Sky.color_bottom[2].g+b*Sky.color_bottom[3].g,c*Sky.color_bottom[2].b+b*Sky.color_bottom[3].b)):(this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[3].r,Sky.color_top[3].g,Sky.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[3].r,
Sky.color_bottom[3].g,Sky.color_bottom[3].b));.2>a?this.sun.color.setHex(Sky.moon_color):.3>a?(b=10*(a-.2),.5>b?(this.sun.intensity=.3*(2-2*b),this.sun.color.setHex(Sky.moon_color)):(this.sun.intensity=.6*b,this.sun.color.setHex(Sky.sun_color))):.7>a?this.sun.color.setHex(Sky.sun_color):.8>a?(b=10*(a-.7),.5>b?(this.sun.intensity=.3*(2-2*b),this.sun.color.setHex(Sky.sun_color)):(this.sun.intensity=.6*b,this.sun.color.setHex(Sky.moon_color))):this.sun.color.setHex(Sky.moon_color);b=MathUtils.pi2*a-
MathUtils.pid2;.25<a&&.75>a?(this.sun.position.x=this.sun_distance*Math.cos(b),this.sun.position.y=this.sun_distance*Math.sin(b)):(this.sun.position.x=this.sun_distance*Math.cos(b+Math.PI),this.sun.position.y=this.sun_distance*Math.sin(b+Math.PI))};
Sky.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.auto_update=this.auto_update;a.object.sun_distance=this.sun_distance;a.object.day_time=this.day_time;a.object.time=this.time;a.object.sun={};a.object.sun.shadow=this.sun.shadow.toJSON();return a};
function PerspectiveCamera(a,b,c,d){void 0===c&&(c=.1);void 0===d&&(d=1E5);THREE.PerspectiveCamera.call(this,a,b,c,d);this.name="camera";this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clear_depth=this.clear_color=!1;this.listener=new THREE.AudioListener}PerspectiveCamera.prototype=Object.create(THREE.PerspectiveCamera.prototype);PerspectiveCamera.prototype.initialize=function(){for(var a=0;a<this.children.length;a++)this.children[a].initialize()};
PerspectiveCamera.prototype.destroy=function(){var a=ObjectUtils.getScene(this);null!==a&&a.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};PerspectiveCamera.prototype.updateMatrixWorld=function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null!==this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld=this.matrix,this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=this.children,c=0;c<b.length;c++)b[c].updateMatrixWorld(a)};
PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=this.near*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,b=2*a,c=this.aspect*b*(void 0!==this.viewport?this.viewport.x/this.viewport.y:1),d=-.5*c;0!==this.filmOffset&&(d+=this.near*this.filmOffset/this.getFilmWidth());this.projectionMatrix.makeFrustum(d,d+c,a-b,a,this.near,this.far)};
PerspectiveCamera.prototype.toJSON=function(a){a=THREE.PerspectiveCamera.prototype.toJSON.call(this,a);a.object.clear_color=this.clear_color;a.object.clear_depth=this.clear_depth;a.object.viewport=this.viewport.toArray();a.object.offset=this.offset.toArray();return a};
function OrthographicCamera(a,b,c,d,e){void 0===d&&(d=0);void 0===e&&(e=1E5);THREE.OrthographicCamera.call(this,-1,1,1,-1,d,e);this.name="camera";this.size=a;this.aspect=b;this.mode=void 0!==c?c:OrthographicCamera.FIXED_VERTICAL;this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clear_depth=this.clear_color=!1;this.listener=new THREE.AudioListener}OrthographicCamera.prototype=Object.create(THREE.OrthographicCamera.prototype);OrthographicCamera.FIXED_VERTICAL=0;
OrthographicCamera.FIXED_HORIZONTAL=1;OrthographicCamera.prototype.initialize=function(){for(var a=0;a<this.children.length;a++)this.children[a].initialize()};OrthographicCamera.prototype.destroy=function(){var a=ObjectUtils.getScene(this);null!==a&&a.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};
OrthographicCamera.prototype.updateProjectionMatrix=function(){this.mode===OrthographicCamera.FIXED_VERTICAL?(this.top=this.size/2,this.bottom=-this.top,this.right=this.viewport.x/this.viewport.y*this.aspect*this.top,this.left=-this.right):this.mode===OrthographicCamera.FIXED_HORIZONTAL&&(this.right=this.size/2,this.left=-this.right,this.top=this.right/this.aspect*(this.viewport.x/this.viewport.y),this.bottom=-this.top);THREE.OrthographicCamera.prototype.updateProjectionMatrix.call(this)};
OrthographicCamera.prototype.toJSON=function(a){a=THREE.OrthographicCamera.prototype.toJSON.call(this,a);a.object.size=this.size;a.object.aspect=this.aspect;a.object.mode=this.mode;a.object.clear_color=this.clear_color;a.object.clear_depth=this.clear_depth;a.object.viewport=this.viewport.toArray();a.object.offset=this.offset.toArray();return a};
function AudioEmitter(a){THREE.Audio.call(this,AudioEmitter.listener);this.name="audio";this.type="Audio";this.audio=void 0!==a?a:null;this.autoplay=!0;this.playbackRate=1;this.startTime=0;this.source.loop=!0}AudioEmitter.listener=new THREE.AudioListener;AudioEmitter.prototype=Object.create(THREE.Audio.prototype);AudioEmitter.prototype.initialize=function(){var a=this;null!==this.audio&&THREE.AudioContext.decodeAudioData(this.audio.data,function(b){a.setBuffer(b)});for(var b=0;b<this.children.length;b++)this.children[b].initialize()};
AudioEmitter.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect());for(var a=0;a<this.children.length;a++)this.children[a].dispose()};AudioEmitter.prototype.toJSON=function(a){var b=this.audio;a=THREE.Object3D.prototype.toJSON.call(this,a,function(a,d){b=b.toJSON(a)});a.object.audio=b.uuid;a.object.autoplay=this.autoplay;a.object.startTime=this.startTime;a.object.playbackRate=this.playbackRate;a.object.source={};a.object.source.loop=this.source.loop;return a};
function Script(a){THREE.Object3D.call(this);this.type="Script";this.name="script";this.script=null;this.setCode(void 0!==a?a:"this.initialize = function()\n{\n\t//TODO <INITIALIZATION CODE>\n}\n\nthis.update = function()\n{\n\t//TODO <UPDATE CODE>\n}");this.scene=this.program=null}Script.prototype=Object.create(THREE.Object3D.prototype);
Script.prototype.initialize=function(){for(var a=this;null!==a.parent;)a=a.parent,a instanceof Scene?this.scene=a:a instanceof Program&&(this.program=a);void 0!==this.script.initialize&&this.script.initialize.call(this);for(a=0;a<this.children.length;a++)this.children[a].initialize()};Script.prototype.update=function(){void 0!==this.script.update&&this.script.update.call(this);for(var a=0;a<this.children.length;a++)this.children[a].update()};
Script.prototype.setCode=function(a){try{this.code=a,this.script=new new Function(this.code)}catch(b){this.script=new function(){}}};Script.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.code=this.code;return a};function BlockScript(a){THREE.Object3D.call(this);this.name=this.type="BlockScript";this.script=Function("");this.scene=this.program=null}BlockScript.prototype=Object.create(THREE.Object3D.prototype);
BlockScript.prototype.initialize=function(){for(var a=0;a<this.children.length;a++)this.children[a].initialize()};BlockScript.prototype.update=function(){for(var a=0;a<this.children.length;a++)this.children[a].update()};function PhysicsObject(){THREE.Object3D.call(this);this.name="physics";this.type="Physics";this.body=new CANNON.Body;this.body.type=CANNON.Body.DYNAMIC;this.body.mass=1;this.world=null}PhysicsObject.prototype=Object.create(THREE.Object3D.prototype);
PhysicsObject.prototype.initialize=function(){this.body.position.copy(this.position);this.body.quaternion.copy(this.quaternion);for(var a=this;null!==a.parent;)a=a.parent,a instanceof Scene&&(this.world=a.world,this.world.addBody(this.body));for(a=0;a<this.children.length;a++)this.children[a].initialize()};PhysicsObject.prototype.update=function(){this.position.copy(this.body.position);this.body.fixedRotation||this.quaternion.copy(this.body.quaternion);for(var a=0;a<this.children.length;a++)this.children[a].update()};
PhysicsObject.prototype.addShape=function(a){a instanceof CANNON.Shape&&this.body.addShape(a)};
PhysicsObject.prototype.toJSON=function(a){a=THREE.Object3D.prototype.toJSON.call(this,a);a.object.body={};a.object.body.type=this.body.type;a.object.body.mass=this.body.mass;a.object.body.linearDamping=this.body.linearDamping;a.object.body.angularDamping=this.body.angularDamping;a.object.body.allowSleep=this.body.allowSleep;a.object.body.sleepSpeedLimit=this.body.sleepSpeedLimit;a.object.body.sleepTimeLimit=this.body.sleepTimeLimit;a.object.body.collisionFilterGroup=this.body.collisionFilterGroup;
a.object.body.collisionFilterMask=this.body.collisionFilterMask;a.object.body.fixedRotation=this.body.fixedRotation;a.object.body.shapes=[];for(var b=this.body.shapes,c=0;c<b.length;c++){var d=b[c],e={};e.type=d.type;d.type===CANNON.Shape.types.SPHERE?e.radius=d.radius:d.type===CANNON.Shape.types.BOX?(e.halfExtents={},e.halfExtents.x=d.halfExtents.x,e.halfExtents.y=d.halfExtents.y,e.halfExtents.z=d.halfExtents.z):d.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&(e.vertices=d.vertices,e.faces=d.faces);
a.object.body.shapes[c]=e}return a};
function SpineAnimation(a,b,c,d){if(void 0!==d)var e=new spine.TextureAtlas(b,function(a){for(var b=0;b<d.length;b++)if(d[b].name===a)return a=new SpineTexture(d[b].texture),b=a.texture.image,b.width=1024,b.height=1024,a});else d=[],e=new spine.TextureAtlas(b,function(a){var b=new SpineTexture(new Texture(new Image(c+"\\"+a))),e=b.texture.image;e.width=1024;e.height=1024;d.push({name:a,texture:b.texture});return b});e=new spine.TextureAtlasAttachmentLoader(e);e=(new spine.SkeletonJson(e)).readSkeletonData(a);
THREE.Mesh.call(this);this.zOffset=.1;this.skeleton=new spine.Skeleton(e);e=new spine.AnimationStateData(e);this.state=new spine.AnimationState(e);this.batcher=new spine.threejs.MeshBatcher(this);e=new THREE.MeshBasicMaterial;e.side=THREE.DoubleSide;e.transparent=!0;e.name="spine";e.alphaTest=.5;this.material=e;this.json=a;this.atlas=b;this.textures=d;this.name="spine";this.type="SpineAnimation";this.scale.set(.005,.005,.005);this.frustumCulled=!1;this.castShadow=this.receiveShadow=!0;this.clock=
new THREE.Clock}SpineAnimation.prototype=Object.create(THREE.Mesh.prototype);SpineAnimation.QUAD_TRIANGLES=[0,1,2,2,3,0];SpineAnimation.prototype.update=function(){var a=this.state,b=this.skeleton;a.update(this.clock.getDelta());a.apply(b);b.updateWorldTransform();this.updateGeometry();for(a=0;a<this.children.length;a++)this.children[a].update()};SpineAnimation.prototype.getAnimations=function(){return this.state.data.skeletonData.animations};
SpineAnimation.prototype.setAnimation=function(a,b){try{this.state.setAnimation(a,b,!0)}catch(c){}};SpineAnimation.prototype.getSkins=function(){return this.state.data.skeletonData.skins};
SpineAnimation.prototype.updateGeometry=function(){var a,b,c=this.skeleton.drawOrder,d=0,e=this.zOffset,h=this.batcher;h.begin();for(var f=0,k=c.length;f<k;f++){a=c[f];b=a.getAttachment();var l;if(b instanceof spine.RegionAttachment)l=b,a=l.updateWorldVertices(a,!1),b=SpineAnimation.QUAD_TRIANGLES,l=l.region.renderObject.texture;else if(b instanceof spine.MeshAttachment)l=b,a=l.updateWorldVertices(a,!1),b=l.triangles,l=l.region.renderObject.texture;else continue;if(null!==l){if(!this.material.map){var n=
this.material;n.map=l.texture;n.needsUpdate=!0}h.batch(a,b,d);d+=e}}h.end()};SpineAnimation.prototype.toJSON=function(a){var b=this.geometry,c=this.material;this.material=this.geometry=void 0;var d=[],e=this;a=THREE.Object3D.prototype.toJSON.call(this,a,function(a,b){for(b=0;b<e.textures.length;b++){var c=e.textures[b].texture.toJSON(a);d.push({name:e.textures[b].name,texture:c.uuid})}});a.object.json=this.json;a.object.atlas=this.atlas;a.object.textures=d;this.geometry=b;this.material=c;return a};
function SpineTexture(a){spine.Texture.call(this,a.image);this.texture=a;this.texture.flipY=!1}SpineTexture.prototype=Object.create(spine.Texture.prototype);SpineTexture.prototype.setFilters=function(a,b){this.texture.minFilter=SpineTexture.getTextureFilter(a);this.texture.magFilter=SpineTexture.getTextureFilter(b)};SpineTexture.prototype.setWraps=function(a,b){this.texture.wrapS=SpineTexture.getTextureWrap(a);this.texture.wrapT=SpineTexture.getTextureWrap(b)};SpineTexture.prototype.dispose=function(){this.texture.dispose()};
SpineTexture.getTextureFilter=function(a){return a===spine.TextureFilter.Linear?THREE.LinearFilter:a===spine.TextureFilter.MipMap||a===spine.TextureFilter.MipMapLinearLinear?THREE.LinearMipMapLinearFilter:a===spine.TextureFilter.MipMapLinearNearest?THREE.LinearMipMapNearestFilter:a===spine.TextureFilter.MipMapNearestLinear?THREE.NearestMipMapLinearFilter:a===spine.TextureFilter.MipMapNearestNearest?THREE.NearestMipMapNearestFilter:a===spine.TextureFilter.Nearest?THREE.NearestFilter:null};
SpineTexture.getTextureWrap=function(a){if(a===spine.TextureWrap.ClampToEdge)return THREE.ClampToEdgeWrapping;if(a===spine.TextureWrap.MirroredRepeat)return THREE.MirroredRepeatWrapping;if(a===spine.TextureWrap.Repeat)return THREE.RepeatWrapping};function Bone(){THREE.Bone.call(this);this.name="bone"}Bone.prototype=Object.create(THREE.Bone.prototype);function Container(){THREE.Object3D.call(this);this.name="container";this.type="Group"}Container.prototype=Object.create(THREE.Object3D.prototype);
function ParticleEmitter(a,b){THREE.Object3D.call(this);this.type="ParticleEmiter";this.name="particle";this.clock=new THREE.Clock;this.group=void 0!==a?new SPE.Group(a):new SPE.Group({texture:{value:new Texture(new Image("data/particle.png"))},maxParticleCount:2E3,blending:THREE.AdditiveBlending,hasPerspective:!0});this.group.mesh.frustumCulled=!1;this.emitter=void 0!==b?new SPE.Emitter(b):new SPE.Emitter({particleCount:2E3,type:SPE.distributions.BOX,maxAge:{value:2,spread:0},velocity:{value:new THREE.Vector3(0,
25,0),spread:new THREE.Vector3(10,7.5,10)},acceleration:{value:new THREE.Vector3(0,-10,0),spread:new THREE.Vector3(10,0,10)},color:{value:[new THREE.Color(1,1,1)],spread:[new THREE.Vector3(0,0,0)]}});this.group.addEmitter(this.emitter)}ParticleEmitter.prototype=Object.create(THREE.Object3D.prototype);ParticleEmitter.prototype.initialize=function(){for(var a=0;a<this.children.length;a++)this.children[a].initialize();this.clock.getDelta();this.add(this.group.mesh)};
ParticleEmitter.prototype.update=function(){this.group.tick(this.clock.getDelta());for(var a=0;a<this.children.length;a++)this.children[a].update()};ParticleEmitter.prototype.dispose=function(){for(var a=0;a<this.children.length;a++)this.children[a].dispose()};
ParticleEmitter.prototype.toJSON=function(a){var b=this.group.texture;a=THREE.Object3D.prototype.toJSON.call(this,a,function(a,d){b=b.toJSON(a)});a.object.group={};a.object.group.texture={};a.object.group.texture.value=b.uuid;a.object.group.textureFrames=this.group.textureFrames;a.object.group.textureFrameCount=this.group.textureFrameCount;a.object.group.textureLoop=this.group.textureLoop;a.object.group.hasPerspective=this.group.hasPerspective;a.object.group.colorize=this.group.colorize;a.object.group.maxParticleCount=
this.group.maxParticleCount;a.object.group.blending=this.group.blending;a.object.group.scale=this.group.scale;a.object.group.depthWrite=this.group.depthWrite;a.object.group.depthTest=this.group.depthTest;a.object.group.fog=this.group.fog;a.object.emitter={};a.object.emitter.uuid=this.emitter.uuid;a.object.emitter.direction=this.emitter.direction;a.object.emitter.particleCount=this.emitter.particleCount;a.object.emitter.duration=this.emitter.duration;a.object.emitter.type=this.emitter.type;a.object.emitter.maxAge=
{};a.object.emitter.maxAge.value=this.emitter.maxAge.value;a.object.emitter.maxAge.spread=this.emitter.maxAge.spread;a.object.emitter.position={};a.object.emitter.position.value=this.emitter.position.value;a.object.emitter.position.spread=this.emitter.position.spread;a.object.emitter.velocity={};a.object.emitter.velocity.value=this.emitter.velocity.value;a.object.emitter.velocity.spread=this.emitter.velocity.spread;a.object.emitter.acceleration={};a.object.emitter.acceleration.value=this.emitter.acceleration.value;
a.object.emitter.acceleration.spread=this.emitter.acceleration.spread;a.object.emitter.wiggle={};a.object.emitter.wiggle.value=this.emitter.wiggle.value;a.object.emitter.wiggle.spread=this.emitter.wiggle.spread;a.object.emitter.opacity={};a.object.emitter.opacity.value=this.emitter.opacity.value;a.object.emitter.opacity.spread=this.emitter.opacity.spread;a.object.emitter.size={};a.object.emitter.size.value=this.emitter.size.value;a.object.emitter.size.spread=this.emitter.size.spread;a.object.emitter.angle=
{};a.object.emitter.angle.value=this.emitter.angle.value;a.object.emitter.angle.spread=this.emitter.angle.spread;a.object.emitter.color={};a.object.emitter.color.value=this.emitter.color.value;a.object.emitter.color.spread=this.emitter.color.spread;return a};
function Program(a){THREE.Object3D.call(this);this.type="Program";this.matrixAutoUpdate=!1;this.name=void 0!==a?a:"program";this.author=this.description="";this.version="0";this.vr=this.lock_pointer=!1;this.vr_scale=1;this.antialiasing=!1;this.shadows=!0;this.shadows_type=THREE.PCFSoftShadowMap;this.images=[];this.videos=[];this.audio=[];this.fonts=[];this.materials=[];this.textures=[];this.geometries=[];this.scene=this.renderer=this.html=this.default_camera=this.default_scene=null}
Program.prototype=Object.create(THREE.Object3D.prototype);Program.prototype.initialize=function(){if(null!==this.default_scene)for(var a=0;a<this.children.length;a++){if(this.children[a].uuid===this.default_scene){this.setScene(this.children[a]);break}}else this.setScene(this.children[0])};Program.prototype.update=function(){this.scene.update()};
Program.prototype.render=function(a){a.setScissorTest(!0);for(var b=a.domElement.width,c=a.domElement.height,d=0;d<this.scene.cameras.length;d++){var e=this.scene.cameras[d];e.clear_color&&a.clearColor();e.clear_depth&&a.clearDepth();a.setViewport(b*e.offset.x,c*e.offset.y,b*e.viewport.x,c*e.viewport.y);a.setScissor(b*e.offset.x,c*e.offset.y,b*e.viewport.x,c*e.viewport.y);a.render(this.scene,e)}a.setScissorTest(!1)};
Program.prototype.resize=function(a,b){for(var c=0;c<this.scene.cameras.length;c++)this.scene.cameras[c].aspect=a/b,this.scene.cameras[c].updateProjectionMatrix()};Program.prototype.addMaterial=function(a){a instanceof THREE.Material&&(this.materials[a.uuid]=a)};Program.prototype.removeMaterial=function(a,b,c){a instanceof THREE.Material&&(delete this.materials[a.uuid],this.traverse(function(d){void 0!==d.material&&d.material.uuid===a.uuid&&(d.material=d instanceof THREE.Sprite?c:b)}))};
Program.prototype.addTexture=function(a){this.textures[a.uuid]=a};Program.prototype.setScene=function(a){a instanceof Scene?this.scene=a:"string"===typeof a&&(this.scene=this.getObjectByName(a));null!==this.scene&&(this.scene.initialize(),0===this.scene.cameras.length&&this.scene.cameras.push(this.default_camera))};Program.prototype.remove=function(a){var b=this.children.indexOf(a);-1<b&&(this.children.splice(b,1),a.parent=null);0===this.children.length&&(this.scene=null)};
Program.prototype.add=function(a){a instanceof Scene&&(this.children.push(a),a.parent=this,1===this.children.length&&(this.scene=this.children[0]))};Program.prototype.clone=function(){return(new ObjectLoader).parse(this.toJSON())};Program.prototype.setInitialScene=function(a){this.default_scene=a.uuid};
Program.prototype.addDefaultScene=function(a){void 0===a&&(a=new THREE.MeshStandardMaterial({roughness:.6,metalness:.2}),a.name="default");var b=new Scene,c=new Sky;c.auto_update=!1;b.add(c);var c=new THREE.BoxBufferGeometry(1,1,1),d=new Mesh(c,a);d.receiveShadow=!0;d.castShadow=!0;d.name="box";b.add(d);d=new Mesh(c,a);d.scale.set(20,1,20);d.position.set(0,-1,0);d.receiveShadow=!0;d.castShadow=!0;d.name="ground";b.add(d);this.add(b)};
Program.prototype.dispose=function(){for(var a=0;a<this.materials.length;a++)this.materials[a].dispose();for(a=0;a<this.textures.length;a++)this.textures[a].dispose();for(a=0;a<this.children.length;a++)this.children[a].dispose()};
Program.prototype.toJSON=function(a){var b=this;a=THREE.Object3D.prototype.toJSON.call(this,a,function(a,d){d=b.materials;for(var c in d){var h=d[c];void 0===a.materials[h.uuid]&&(a.materials[h.uuid]=h.toJSON(a))}});a.object.author=this.author;a.object.description=this.description;a.object.version=this.version;a.object.lock_pointer=this.lock_pointer;a.object.vr=this.vr;a.object.vr_scale=this.vr_scale;null!==this.default_scene&&(a.object.default_scene=this.default_scene);return a};
function Scene(){THREE.Scene.call(this);this.name="scene";this.matrixAutoUpdate=!1;this.clock=new THREE.Clock;this.cameras=[];this.world=new CANNON.World;this.world.defaultContactMaterial.contactEquationStiffness=1E9;this.world.defaultContactMaterial.contactEquationRelaxation=4;this.world.quatNormalizeSkip=0;this.world.quatNormalizeFast=!1;this.world.gravity.set(0,-9.8,0);this.world.broadphase=new CANNON.NaiveBroadphase;this.world.solver=new CANNON.SplitSolver(new CANNON.GSSolver);this.world.solver.tolerance=
.1;this.world.solver.iterations=7}Scene.prototype=Object.create(THREE.Scene.prototype);Scene.prototype.initialize=function(){for(var a=0;a<this.children.length;a++)this.children[a].initialize()};Scene.prototype.update=function(){this.world.step(this.clock.getDelta());for(var a=0;a<this.children.length;a++)this.children[a].update()};Scene.prototype.getCamera=function(a,b){void 0===b&&(b=this);if(a===b.uuid)return b;b=b.children;for(var c=0;c<b.length;c++){var d=this.getCamera(a,b[c]);if(null!==d)return d}return null};
Scene.prototype.addCamera=function(a){this.cameras.push(a)};Scene.prototype.removeCamera=function(a){a=this.cameras.indexOf(a);-1<a&&this.cameras.splice(a,1)};Scene.prototype.setFogMode=function(a){var b=null!==this.fog?this.fog.color.getHex():"#FFFFFF";a===THREE.Fog.LINEAR?this.fog=new THREE.Fog(b,5,20):a===THREE.Fog.EXPONENTIAL?this.fog=new THREE.FogExp2(b,.01):a===THREE.Fog.NONE&&(this.fog=null)};
Scene.prototype.toJSON=function(a){a=THREE.Scene.prototype.toJSON.call(this,a);a.object.cameras=[];for(var b=0;b<this.cameras.length;b++)a.object.cameras.push(this.cameras[b].uuid);a.object.world={};a.object.world.gravity=this.world.quatNormalizeFast;a.object.world.solver={};a.object.world.solver.tolerance=this.world.solver.tolerance;a.object.world.solver.iterations=this.world.solver.iterations;return a};function Base64Utils(){}
Base64Utils.fromArraybuffer=function(a){var b="";a=new Uint8Array(a);for(var c=a.byteLength%3,d=a.byteLength-c,e,h,f,k,l=0;l<d;l+=3)k=a[l]<<16|a[l+1]<<8|a[l+2],e=(k&16515072)>>18,h=(k&258048)>>12,f=(k&4032)>>6,k&=63,b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k];1===
c?(k=a[d],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&3)<<4]+"=="):2===c&&(k=a[d]<<8|a[d+1],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&64512)>>10]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(k&15)<<2]+"=");return b};
Base64Utils.fromBinaryString=function(a){for(var b="",c=a.length%3,d=a.length-c,e,h,f,k=0;k<d;k+=3)e=a.charCodeAt(k)&255,h=a.charCodeAt(k+1),f=a.charCodeAt(k+2),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>2),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((e&3)<<4|(h&240)>>4),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((h&15)<<2|(f&192)>>6),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f&
63);1===c?(e=a.charCodeAt(k)&255,b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>2),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((e&3)<<4),b+="=="):2===c&&(e=a.charCodeAt(k)&255,h=a.charCodeAt(k+1),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>2),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((e&3)<<4|(h&240)>>4),b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((h&
15)<<2),b+="=");return b};function ArraybufferUtils(){}ArraybufferUtils.fromBinaryString=function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c};
ArraybufferUtils.fromBase64=function(a){for(var b=a.length/4*3,c=new ArrayBuffer(b),d=new Uint8Array(c),e,h,f,k,l=0,n=0;l<b;l+=3)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(n++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(n++)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(n++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a.charAt(n++)),d[l]=
e<<2|h>>4,64!==f&&(d[l+1]=(h&15)<<4|f>>2),64!==k&&(d[l+2]=(f&3)<<6|k);return c};function MathUtils(){}MathUtils.pi2=2*Math.PI;MathUtils.pid2=Math.PI/2;function ObjectUtils(){}
ObjectUtils.getMaterials=function(a,b){function c(a){void 0===b[a.uuid]&&(b[a.uuid]=a)}void 0===b&&(b=[]);for(var d=0;d<a.children.length;d++){var e=a.children[d];if(!(e.hidden||void 0===e.material||e instanceof Sky||e instanceof SpineAnimation))if(e.material instanceof THREE.Material)c(e.material);else if(e.material instanceof THREE.MultiMaterial)for(var h=e.material.materials,f=0;f<h.length;f++)c(h[f]);ObjectUtils.getMaterials(e,b)}return b};
ObjectUtils.getTextures=function(a,b){function c(a){null!==a&&void 0!==a&&void 0===b[a.uuid]&&(b[a.uuid]=a)}void 0===b&&(b=[]);for(var d=0;d<a.children.length;d++){var e=a.children[d];if(void 0!==e.material){var h=e.material;c(h.map);c(h.bumpMap);c(h.normalMap);c(h.displacementMap);c(h.specularMap);c(h.emissiveMap);c(h.alphaMap);c(h.roughnessMap);c(h.metalnessMap)}else e instanceof ParticleEmitter&&c(e.group.texture);ObjectUtils.getTextures(e,b)}return b};
ObjectUtils.getScene=function(a){for(;null!==a.parent;)if(a=a.parent,a instanceof Scene)return a;return null};ObjectUtils.getRoot=function(a){for(;null!==a.parent;)a=a.parent;return a};ObjectUtils.setMatrixAutoUpdate=function(a,b){a.traverse(function(a){a.matrixAutoUpdate=b})};ObjectUtils.setShadowReceiving=function(a,b){a.traverse(function(a){a.receiveShadow=b})};ObjectUtils.setShadowCasting=function(a,b){a.traverse(function(a){a.castShadow=b})};
ObjectUtils.isChildOf=function(a,b){for(var c=0;c<a.children.length;c++)if(a.children[c]===b||ObjectUtils.isChildOf(a.children[c],b))return!0;return!1};var PI2=Math.PI/2;function Mesh2shape(){}Mesh2shape.Type={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron"};
Mesh2shape.createShape=function(a,b){if(void 0!==b)return b===Mesh2shape.Type.BOX?Mesh2shape.createBoundingBoxShape(a):b===Mesh2shape.Type.CYLINDER?Mesh2shape.createBoundingCylinderShape(a,options):b===Mesh2shape.Type.SPHERE?Mesh2shape.createBoundingSphereShape(a,options):b===Mesh2shape.Type.HULL?Mesh2shape.createConvexPolyhedron(a):null;var c=Mesh2shape.getGeometry(a);if(!c)return null;b=c.metadata?c.metadata.type:c.type;switch(b){case "BoxGeometry":case "BoxBufferGeometry":return Mesh2shape.createBoxShape(c);
case "CylinderGeometry":case "CylinderBufferGeometry":return Mesh2shape.createCylinderShape(c);case "PlaneGeometry":case "PlaneBufferGeometry":return Mesh2shape.createPlaneShape(c);case "SphereGeometry":case "SphereBufferGeometry":return Mesh2shape.createSphereShape(c);case "TubeGeometry":return Mesh2shape.createTubeShape(c);case "Geometry":case "BufferGeometry":return Mesh2shape.createConvexPolyhedron(a);default:return console.warn("Unrecognized geometry: Using bounding box as shape.",c.type),Mesh2shape.createBoxShape(c)}};
Mesh2shape.createBoxShape=function(a){if(!Mesh2shape.getVertices(a).length)return null;a.computeBoundingBox();a=a.boundingBox;return new CANNON.Box(new CANNON.Vec3((a.max.x-a.min.x)/2,(a.max.y-a.min.y)/2,(a.max.z-a.min.z)/2))};
Mesh2shape.createBoundingBoxShape=function(a){var b,c=new THREE.BoundingBoxHelper(a);c.update();var d=c.box;if(!isFinite(d.min.lengthSq()))return null;d=new CANNON.Box(new CANNON.Vec3((d.max.x-d.min.x)/2,(d.max.y-d.min.y)/2,(d.max.z-d.min.z)/2));a.updateMatrixWorld();b=new THREE.Vector3;b.setFromMatrixPosition(a.matrixWorld);a=c.position.sub(b);a.lengthSq()&&(d.offset=a);return d};
Mesh2shape.createConvexPolyhedron=function(a){var b,c,d;b=Mesh2shape.getGeometry(a);b instanceof THREE.BufferGeometry&&(b=(new THREE.Geometry).fromBufferGeometry(b));if(!b||!b.vertices.length)return null;for(a=0;a<b.vertices.length;a++)b.vertices[a].x+=1E-4*(Math.random()-.5),b.vertices[a].y+=1E-4*(Math.random()-.5),b.vertices[a].z+=1E-4*(Math.random()-.5);d=(new quickhull)(b);console.log(d);b=Array(d.vertices.length);for(a=0;a<d.vertices.length;a++)b[a]=new CANNON.Vec3(d.vertices[a].x,d.vertices[a].y,
d.vertices[a].z);c=Array(d.faces.length);for(a=0;a<d.faces.length;a++)c[a]=[d.faces[a].a,d.faces[a].b,d.faces[a].c];return new CANNON.ConvexPolyhedron(b,c)};Mesh2shape.createCylinderShape=function(a){a=a.metadata?a.metadata.parameters:a.parameters;a=new CANNON.Cylinder(a.radiusTop,a.radiusBottom,a.height,a.radialSegments);a.orientation=new CANNON.Quaternion;a.orientation.setFromEuler(THREE.Math.degToRad(-90),0,0,"XYZ").normalize();return a};
Mesh2shape.createBoundingCylinderShape=function(a,b){var c=["x","y","z"];b=b.cylinderAxis||"y";c=c.splice(c.indexOf(b),1)&&c;a=Mesh2shape.getGeometry(a);a.computeBoundingBox();a.computeBoundingSphere();c=.5*Math.max(a.boundingBox.max[c[0]]-a.boundingBox.min[c[0]],a.boundingBox.max[c[1]]-a.boundingBox.min[c[1]]);a=new CANNON.Cylinder(c,c,a.boundingBox.max[b]-a.boundingBox.min[b],12);a.orientation=new CANNON.Quaternion;a.orientation.setFromEuler("y"===b?PI2:0,"z"===b?PI2:0,0,"XYZ").normalize();return a};
Mesh2shape.createPlaneShape=function(a){a.computeBoundingBox();a=a.boundingBox;return new CANNON.Box(new CANNON.Vec3((a.max.x-a.min.x)/2||.1,(a.max.y-a.min.y)/2||.1,(a.max.z-a.min.z)/2||.1))};Mesh2shape.createSphereShape=function(a){return new CANNON.Sphere((a.metadata?a.metadata.parameters:a.parameters).radius)};Mesh2shape.createBoundingSphereShape=function(a,b){a=Mesh2shape.getGeometry(a);a.computeBoundingSphere();return new CANNON.Sphere(b.sphereRadius||a.boundingSphere.radius)};
Mesh2shape.createTubeShape=function(a){var b=new THREE.BufferGeometry;b.fromGeometry(a);return createTrimeshShape(b)};Mesh2shape.createTrimeshShape=function(a){var b=Mesh2shape.getVertices(a);if(!b.length)return null;a=Object.keys(b).map(Number);return new CANNON.Trimesh(b,a)};
Mesh2shape.getGeometry=function(a){var b=Mesh2shape.getMeshes(a);if(0===b.length)return null;var c=new THREE.Geometry;if(1===b.length){a=new THREE.Vector3;var d=new THREE.Quaternion,e=new THREE.Vector3,c=b[0].geometry.clone();c.metadata=b[0].geometry.metadata;b[0].updateMatrixWorld();b[0].matrixWorld.decompose(a,d,e);return c.scale(e.x,e.y,e.z)}for(d=new THREE.Geometry;e=b.pop();)e.updateMatrixWorld(),e.geometry instanceof THREE.BufferGeometry?(c.fromBufferGeometry(e.geometry),d.merge(c,e.matrixWorld)):
d.merge(e.geometry,e.matrixWorld);b=new THREE.Matrix4;b.scale(a.scale);d.applyMatrix(b);return d};Mesh2shape.getVertices=function(a){a.attributes||(a=(new THREE.BufferGeometry).fromGeometry(a));return a.attributes.position.array};Mesh2shape.getMeshes=function(a){var b=[];a.traverse(function(a){"Mesh"===a.type&&b.push(a)});return b};function FileSystem(){}
FileSystem.readFile=function(a,b,c){void 0===b&&(b=!0);if(void 0!==App.fs){if(b)return App.fs.readFileSync(a,"utf8");App.fs.readFile(a,"utf8",c)}else{var d=new XMLHttpRequest;d.overrideMimeType("text/plain");d.open("GET",a,!b);d.onreadystatechange=function(){200!==d.status&&0!==d.status||void 0===c||c(d.responseText)};d.send(null);return d.responseText}};
FileSystem.readFileArrayBuffer=function(a){if(void 0!==App.fs){a=App.fs.readFileSync(a);for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a[e];return c}b=new XMLHttpRequest;b.open("GET",a,!1);b.overrideMimeType("text/plain; charset=x-user-defined");b.send(null);return ArraybufferUtils.fromBinaryString(b.response)};
FileSystem.readFileBase64=function(a){if(void 0!==App.fs)return a=App.fs.readFileSync(a),(new Buffer(a)).toString("base64");var b=new XMLHttpRequest;b.open("GET",a,!1);b.overrideMimeType("text/plain; charset=x-user-defined");b.send(null);return Base64Utils.fromBinaryString(b.response)};FileSystem.writeFile=function(a,b){void 0!==App.fs&&(a=App.fs.createWriteStream(a,"utf8"),a.write(b),a.end())};FileSystem.copyFile=function(a,b){void 0!==App.fs&&App.fs.createReadStream(a).pipe(App.fs.createWriteStream(b))};
FileSystem.makeDirectory=function(a){if(void 0!==App.fs)try{App.fs.mkdirSync(a)}catch(b){}};FileSystem.getFilesDirectory=function(a){if(void 0!==App.fs)try{return App.fs.readdirSync(a)}catch(b){}return[]};
FileSystem.copyFolder=function(a,b){if(void 0!==App.fs){FileSystem.makeDirectory(b);for(var c=App.fs.readdirSync(a),d=0;d<c.length;d++){var e=a+"\\"+c[d],h=b+"\\"+c[d],f=App.fs.statSync(e);f.isDirectory()?FileSystem.copyFolder(e,h):f.isSymbolicLink()?App.fs.symlinkSync(App.fs.readlinkSync(e),h):FileSystem.copyFile(e,h)}}};
FileSystem.chooseFile=function(a,b,c){var d=document.createElement("input");d.type="file";d.accept=void 0!==b?b:"";void 0!==c&&(d.nwsaveas=!0!==c?c:"file");d.onchange=function(b){void 0!==a&&a(d.files)};d.click()};FileSystem.getFileName=function(a){return a.substring(a.lastIndexOf("\\")+1,a.lastIndexOf("."))};FileSystem.getFileExtension=function(a){return a.substring(a.lastIndexOf(".")+1,a.length)};
